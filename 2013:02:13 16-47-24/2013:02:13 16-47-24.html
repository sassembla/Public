<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1187.37">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #78492a; background-color: #ebebeb}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; min-height: 13.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'Hiragino Kaku Gothic ProN'}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; background-color: #ebebeb}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; background-color: #ebebeb; min-height: 13.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #4f8187; background-color: #ebebeb}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #3d1d81; background-color: #ebebeb}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #d12f1b; background-color: #ebebeb}
    span.s1 {font: 12.0px Helvetica}
    span.s2 {font: 11.0px Helvetica}
    span.s3 {font: 12.0px 'Hiragino Kaku Gothic ProN'}
    span.s4 {font: 11.0px Menlo}
    span.s5 {color: #bb2ca2}
    span.s6 {color: #4f8187}
    span.s7 {color: #703daa}
    span.s8 {font: 11.0px 'Hiragino Kaku Gothic ProN'}
    span.s9 {color: #000000}
    span.s10 {color: #31595d}
    span.s11 {color: #d12f1b}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>Unity iOSでのWebSocket</b></p>
<p class="p2"><b></b><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="s1"><span class="Apple-tab-span">	</span>Unity</span>からiOSでのWebSocket用に、使って遊んでみる。</p>
<p class="p3"><span class="Apple-tab-span">	</span><a href="https://github.com/square/SocketRocket">https://github.com/square/SocketRocket</a></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>よく見たらSquareだった。あの決済のアレですかね。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>HOW TO USE(つかいかた)</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>悩むところ無かった。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ステップ数的に、</p>
<p class="p3"><span class="Apple-tab-span">	</span>1.DLしてプロジェクトに該当ライブラリ部分を放り込む</p>
<p class="p3"><span class="Apple-tab-span">	</span>2.frameworkを追加</p>
<p class="p3"><span class="Apple-tab-span">	</span>3.ARC設定を調整(必要であれば)</p>
<p class="p3"><span class="Apple-tab-span">	</span>4.Delegateとかをセット</p>
<p class="p3"><span class="Apple-tab-span">	</span>でOK。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>DLしてプロジェクトに該当ライブラリ部分を放り込む</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>下記フォルダをそのままプロジェクトに放り込めばいい感じ。</p>
<p class="p4"><br></p>
<p class="p4"><span class="Apple-tab-span">	</span></p>
<p class="p3"><b>frameworkを追加</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>libicucore.dylib</p>
<p class="p3"><span class="Apple-tab-span">	</span>と</p>
<p class="p3"><span class="Apple-tab-span">	</span>Security.framework</p>
<p class="p3"><span class="Apple-tab-span">	</span>を追加。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>ARCを調整</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>SRWebocket.mに</p>
<p class="p5">#if !__has_feature(objc_arc)<span class="Apple-converted-space"> </span></p>
<p class="p5">#error SocketRocket mu<span class="s2">u</span>st be compiled with ARC enabled</p>
<p class="p5">#endif</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>があり、ARC無いとこで動かすなカスが！！　的な様相。ちなみにtypoがry</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ファイル単体に、 -fobjc-arc　を追加して通過。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>Delegate</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>socketを使用するクラスに対して、</p>
<p class="p6"><span class="s3"><span class="Apple-tab-span">	</span></span>&lt;SRWebSocketDelegate&gt;</p>
<p class="p7"><br></p>
<p class="p8"><span class="s4"><span class="Apple-tab-span">	</span></span>と、下記メソッドを追加</p>
<p class="p9">- (<span class="s5">void</span>)webSocketDidOpen:(<span class="s6">SRWebSocket</span> *)webSocket{}</p>
<p class="p10"><br></p>
<p class="p9">- (<span class="s5">void</span>)webSocket:(<span class="s6">SRWebSocket</span> *)webSocket didFailWithError:(<span class="s7">NSError</span> *)error{}</p>
<p class="p10"><br></p>
<p class="p9">- (<span class="s5">void</span>)webSocket:(<span class="s6">SRWebSocket</span> *)webSocket didReceiveMessage:(<span class="s5">id</span>)message{}</p>
<p class="p10"><br></p>
<p class="p9">- (<span class="s5">void</span>)webSocket:(<span class="s6">SRWebSocket</span> *)webSocket didCloseWithCode:(<span class="s7">NSInteger</span>)code reason:(<span class="s7">NSString</span> *)reason wasClean:(<span class="s5">BOOL</span>)wasClean{}<span class="s8"><span class="Apple-tab-span">	</span></span></p>
<p class="p7"><span class="Apple-tab-span">	</span></p>
<p class="p4"><br></p>
<p class="p3"><b>コード</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>単純に、<span class="Apple-tab-span">	</span>デリゲートをセットして使えばOK。</p>
<p class="p11"><span class="Apple-tab-span">	</span>_webSocket<span class="s9">.</span>delegate<span class="s9"> = </span><span class="s5">nil</span><span class="s9">;</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">    </span>[</span>_webSocket<span class="s9"> </span><span class="s10">close</span><span class="s9">];</span></p>
<p class="p10"><span class="Apple-converted-space">    </span></p>
<p class="p12"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s6">_webSocket</span><span class="s9"> = [[</span><span class="s6">SRWebSocket</span><span class="s9"> </span>alloc<span class="s9">] </span><span class="s10">initWithURLRequest</span><span class="s9">:[</span><span class="s7">NSURLRequest</span><span class="s9"> </span>requestWithURL<span class="s9">:[</span><span class="s7">NSURL</span><span class="s9"> </span>URLWithString<span class="s9">:</span><span class="s11">@"ws://localhost:9000/chat"</span><span class="s9">]]];</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">    </span></span>_webSocket<span class="s9">.</span>delegate<span class="s9"> = </span><span class="s5">self</span><span class="s9">;</span></p>
<p class="p10"><span class="Apple-converted-space">    </span></p>
<p class="p13"><span class="s9"><span class="Apple-converted-space">    </span></span><span class="s5">self</span><span class="s9">.</span><span class="s7">title</span><span class="s9"> = </span>@"Opening Connection..."<span class="s9">;</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">    </span>[</span>_webSocket<span class="s9"> </span><span class="s10">open</span><span class="s9">];</span></p>
<p class="p4"><br></p>
<p class="p3">以上。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
</body>
</html>
