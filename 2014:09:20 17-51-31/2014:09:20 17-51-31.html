<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1265.21">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    span.s1 {font: 12.0px Helvetica}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>iOSをBLEマウスにするのあきらめていなかった</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="s1"><span class="Apple-tab-span">	</span>Bluetooth 4.0</span>で<span class="s1">iOS</span>をマウスにするのには失敗した前回。</p>
<p class="p3"><span class="Apple-tab-span">	</span>とりあえずMac側にサーバアプリ入れないと駄目だ、、死のう、、、</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>→あきらめてなかった。</p>
<p class="p3"><span class="Apple-tab-span">	</span>本体を作り終わったら再開する。まず一度終わらせよう。</p>
<p class="p4"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>別の実装を探す準備</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="http://www.bluez.org/development/git/">http://www.bluez.org/development/git/</a></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>自分のクソみたいな犯罪歴として、iPhone3GSくらいのころにBulletをタッチで動くように</p>
<p class="p3"><span class="Apple-tab-span">	</span>書き直したことあるので、地獄のような移植作業には自信がある。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>とりあえずBonjourでのアプリケーション側の実装を進めている。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span><b>iMousePadPre</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="https://github.com/sassembla/iMousePadPre">https://github.com/sassembla/iMousePadPre</a></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>現在の通信方式</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>さっさと成果が欲しいので(というかモデリングしたいので)日和ってBonjourを使う。</p>
<p class="p3"><span class="Apple-tab-span">	</span>ただし「同一wifi下にすべてのマシンが～」という条件からはどうにかして逃げ出す。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>通信経路は以下のようになった。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>・iPhoneでのBTテザリングあり</p>
<p class="p3"><span class="Apple-tab-span">	</span>・iPadでiPhoneのBTテザリングを受ける</p>
<p class="p3"><span class="Apple-tab-span">	</span>・MacでiPhoneのBTテザリングを受ける</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>この状態で、wifiとか付けなくてもMac-iPad間が接続される。</p>
<p class="p3"><span class="Apple-tab-span">	</span>見てるか哲平、、、wifiなんていらなかったんや、、</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>避けた選択肢について、一応弁解しておくと、</p>
<p class="p3"><span class="Apple-tab-span">	</span>・同一wifi内に全マシンがある場合はそれで良いんじゃない？<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>→wifiでんち食うからキライ</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>→同一wifi内っていう条件が満たしにくい</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>・Macでwifi局作って接続すれば良いんじゃない？</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>→めんどいしいろんな事故のもとになるからヤダ</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>以上。いろんな場所であそびたい勢としてはwifiの単独ポータビリティの無さに殺意。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>Bonjourでの実装</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>参考にしたQiitaの記事が簡潔。</p>
<p class="p3"><span class="Apple-tab-span">	</span>あ、ただ開始時にport指定してるのがあんまり意味ないと思ったのでそこは変更した。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span><b>iOS と Mac OS X 間を Bonjour で通信してちょっと楽しげなこと</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="http://qiita.com/feb19/items/da07d96619acb933a3c3">http://qiita.com/feb19/items/da07d96619acb933a3c3</a></p>
<p class="p4"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>差分</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="https://github.com/sassembla/iMousePadPre/blob/master/ServerPre/ServerPre/AppDelegate.m#L41">https://github.com/sassembla/iMousePadPre/blob/master/ServerPre/ServerPre/AppDelegate.m#L41</a></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>切断周りに何の対処もしてないのでそのへんあとでやる。</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3"><b>残りの実装</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>Bonjour経由での通信にBlocks使えるハンドラが出てるので、データの受け渡しは楽。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>将来BLEのコード書き直した時用に出力 = iOS側を調整する必要があるけど、</p>
<p class="p3"><span class="Apple-tab-span">	</span>その場合は出力側のみ変更すればいいので、データのコーディネートする箇所だけを</p>
<p class="p3"><span class="Apple-tab-span">	</span>独立させておけば改修は簡単そう。</p>
<p class="p4"><span class="Apple-tab-span">	</span></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>マウスのコードの参考</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="http://www.xappsoftware.com/wordpress/2013/07/08/how-to-simulate-mouse-movement-and-clicks-on-mac-os-x/">http://www.xappsoftware.com/wordpress/2013/07/08/how-to-simulate-mouse-movement-and-clicks-on-mac-os-x/</a></p>
<p class="p4"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>キーイベントの参考</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="http://ianyh.com/blog/2013/06/05/accessibility/">http://ianyh.com/blog/2013/06/05/accessibility/</a></p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>このへんのトリガーをNSDataに固めて受けて解答して着火、ってやればOK。</p>
<p class="p3"><span class="Apple-tab-span">	</span>成果物がこちら。</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span><b>iMousePadPre</b></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="https://github.com/sassembla/iMousePadPre">https://github.com/sassembla/iMousePadPre</a></p>
<p class="p4"><br></p>
</body>
</html>
