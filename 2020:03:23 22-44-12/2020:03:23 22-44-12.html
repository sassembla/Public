<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1894.3">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Sans'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #43c0a0; background-color: #000000}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; background-color: #000000}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #d4d69a; background-color: #000000}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #8cd3fe; background-color: #000000}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; background-color: #000000; min-height: 14.0px}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #598a43; background-color: #000000}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #c27e65; background-color: #000000}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px 'Hiragino Sans'; color: #598a43; background-color: #000000}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #4689cc; background-color: #000000}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px 'Hiragino Sans'}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px 'Hiragino Sans'; min-height: 18.0px}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; min-height: 14.0px}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Helvetica}
    span.s1 {font-kerning: none; color: #cacaca}
    span.s2 {font-kerning: none; color: #4689cc}
    span.s3 {font-kerning: none}
    span.s4 {font-kerning: none; color: #8cd3fe}
    span.s5 {font-kerning: none; color: #43c0a0}
    span.s6 {font-kerning: none; color: #b76fb3}
    span.s7 {font-kerning: none; color: #d4d69a}
    span.s8 {font: 12.0px 'Hiragino Sans'; font-kerning: none}
    span.s9 {font: 12.0px Menlo; font-kerning: none; color: #cacaca}
    span.s10 {font: 12.0px Menlo; font-kerning: none}
    span.s11 {font-kerning: none; color: #598a43}
    span.s12 {font: 12.0px 'Hiragino Sans'; font-kerning: none; color: #598a43}
    span.s13 {font-kerning: none; color: #a7c598}
    span.s14 {font: 12.0px Menlo; font-kerning: none; color: #8cd3fe}
    span.s15 {font-kerning: none; color: #c27e65}
    span.s16 {font: 12.0px 'Hiragino Sans'}
    span.s17 {font: 12.0px Helvetica}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>UnityUI用いい感じレイアウトライブラリ LayouTaro</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>UUebVIewで大概人生においてのレイアウトエンジンを実装してみようミッションはこなしたはずだったが、</p>
<p class="p3"><span class="Apple-tab-span">	</span>なんか必要があって実装した。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>・Unityで扱えるUIを型で定義、生成し</p>
<p class="p3"><span class="Apple-tab-span">	</span>・それを可変長引数に放り込むとレイアウトされる</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>というもの。</p>
<p class="p3"><span class="Apple-tab-span">	</span>画像とテキスト、ボタンが使える。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>動機</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>HTMLを書いて独自タグ定義すればいける、というのを目指したUUebViewは、あれはあれで一定の成功を収めている。</p>
<p class="p3"><span class="Apple-tab-span">	</span>が、まーぶっちゃけ「Webの固定されたレイアウトを行う」ことに特化していて、自由度はない。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>反面、ルールさえかければレイアウトできる、みたいな機構が欲しい というニーズは根強く存在していて、今回はこれを叶えたい。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>・タグ定義ができて(LTElement)</p>
<p class="p3"><span class="Apple-tab-span">	</span>・レイアウターを作成すれば</p>
<p class="p3"><span class="Apple-tab-span">	</span>・独自タグで独自レイアウトができる</p>
<p class="p3"><span class="Apple-tab-span">	</span>これが理想。で、かなりいい線まで、非常に小さいコードベースで行けたと思ってる。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>文字だろうが画像だろうがボタンだろうが、所詮はTextとRectなので、それをレイアウトしたい、という比較的ベーシックな欲求も叶えられれば、</p>
<p class="p3"><span class="Apple-tab-span">	</span>このタグはこういうレイアウトにしたい、必ず上に表示されて欲しい、ツールチップみたいにマウスオンしたら、、みたいなマニアックな要望まで、</p>
<p class="p3"><span class="Apple-tab-span">	</span>LayouTaroは(しちめんどくさいレイアウトを書くことに人生を捧げるだけで)叶えてくれる。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>構成としては</p>
<p class="p3"><span class="Apple-tab-span">	</span>・レイアウトまでのフローをフレームワーク化したLayouTaro</p>
<p class="p3"><span class="Apple-tab-span">	</span>・独自タグ(LTElement)</p>
<p class="p3"><span class="Apple-tab-span">	</span>・LayouTaroで動かせるレイアウター</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>この3層になっていて、LayouTaroが提供するフローに則ると自作のタグを自作のレイアウターでレイアウトすることができるよ、という感じ。</p>
<p class="p3"><span class="Apple-tab-span">	</span>右向き行単位での縦揃えと左下への改行を行う、という基礎的なレイアウト機能は、実装例を兼ねてBasicLayoutFunctionという名前で組み込み機能として定義されている。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>読んでもらえばわかるが、レイアウトとはかなりファンキーだ。まあ、これはまだそれなりにかんたん。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>独自のUIパーツを作った時に、それをどう並べるか、各要素が内容によって伸び縮みしたらどうなるか、</p>
<p class="p3"><span class="Apple-tab-span">	</span>そういうのを解決していって欲しい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>使い方</b></p>
<p class="p2"><br></p>
<p class="p3">1. 型の定義</p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">enum</span><span class="s1"> </span><span class="s3">LTElementType</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">Box</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">Image</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">Text</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">Button</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>自分が足したいコンテンツの識別子(LTElementType)を LayouTaro/LayouTaroElements/LayoutElementType.cs に書く。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">2. LTElementの定義</p>
<p class="p4"><span class="s2">public</span><span class="s1"> </span><span class="s2">class</span><span class="s1"> </span><span class="s3">ButtonElement</span><span class="s1"> : </span><span class="s3">LTElement</span><span class="s1">, </span><span class="s3">ILayoutableRect</span></p>
<p class="p5"><span class="s3">{</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">override</span><span class="s1"> </span><span class="s5">LTElementType</span><span class="s1"> </span><span class="s3">GetLTElementType</span><span class="s1">()</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s1"> </span><span class="s3">LTElementType</span><span class="s1">.</span><span class="s3">Button</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s3"> </span><span class="s5">Image</span><span class="s3"> </span><span class="s4">Image</span><span class="s3">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s5">Action</span><span class="s1"> </span><span class="s3">OnTapped</span><span class="s1">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">static</span><span class="s1"> </span><span class="s3">ButtonElement</span><span class="s1"> </span><span class="s7">GO</span><span class="s1">(</span><span class="s3">Image</span><span class="s1"> </span><span class="s4">image</span><span class="s1">, </span><span class="s3">Action</span><span class="s1"> </span><span class="s4">onTapped</span><span class="s1">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">// prefab</span><span class="s8">名を固定して</span><span class="s3">GO</span><span class="s8">を作ってしまおう</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s4">prefabName</span><span class="s1"> = </span><span class="s3">"LayouTaroPrefabs/Button"</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">res</span><span class="s1"> = </span><span class="s3">Resources</span><span class="s1">.</span><span class="s7">Load</span><span class="s1">(</span><span class="s3">prefabName</span><span class="s1">) </span><span class="s2">as</span><span class="s1"> </span><span class="s5">GameObject</span><span class="s1">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s4">r</span><span class="s1"> = </span><span class="s3">Instantiate</span><span class="s1">(</span><span class="s4">res</span><span class="s1">).</span><span class="s3">AddComponent</span><span class="s1">&lt;</span><span class="s5">ButtonElement</span><span class="s1">&gt;();</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">r</span><span class="s3">.</span><span class="s4">Image</span><span class="s3"> = </span><span class="s4">image</span><span class="s3">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">r</span><span class="s1">.</span><span class="s3">OnTapped</span><span class="s1"> = </span><span class="s3">onTapped</span><span class="s1">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">このへんでレシーバセットする</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">button</span><span class="s3"> = </span><span class="s4">r</span><span class="s3">.</span><span class="s7">GetComponent</span><span class="s3">&lt;</span><span class="s5">Button</span><span class="s3">&gt;();</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">button</span><span class="s3">.</span><span class="s4">onClick</span><span class="s3">.</span><span class="s7">AddListener</span><span class="s3">(() =&gt; </span><span class="s4">r</span><span class="s3">.</span><span class="s7">OnTapped</span><span class="s3">());</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s3"> </span><span class="s4">r</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s3"> </span><span class="s5">Vector2</span><span class="s3"> </span><span class="s7">RectSize</span><span class="s3">()</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">ここで、最低でもこのサイズ、とか、ロード失敗したらこのサイズ、とかができる。</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">imageRect</span><span class="s3"> = </span><span class="s2">this</span><span class="s3">.</span><span class="s7">GetComponent</span><span class="s3">&lt;</span><span class="s5">RectTransform</span><span class="s3">&gt;().</span><span class="s4">sizeDelta</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s3"> </span><span class="s4">imageRect</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s3">}</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>UI要素として、LTElementを継承したクラスを定義する。LTElementはMonoBehaviourを継承しているので、このスクリプトはファイル名とクラス名を一致させる必要がある。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>GetLTElementTypeで先ほど定義したLTElementTypeを返すコードを書く。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>定義するUIパーツがRect(矩形)なのかText(文章)なのかで、追加で実装すべきインターフェースが決まる。</p>
<p class="p3"><span class="Apple-tab-span">	</span>ここでは、画像を使うUIパーツを定義したいので、ILayoutableRectを持たせる。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で、このクラスをAddComponentした状態のGameObjectを返す関数を定義すると、あとが楽。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">3. RootElementの定義</p>
<p class="p3"><span class="Apple-tab-span">	</span>2と同様、LTRootElementを継承した型を作成する。</p>
<p class="p3"><span class="Apple-tab-span">	</span>LTElementと異なるのは、GetLTElementsというLTElementのarrayを持たされること。</p>
<p class="p4"><span class="s2">public</span><span class="s1"> </span><span class="s2">class</span><span class="s1"> </span><span class="s3">BoxElement</span><span class="s1"> : </span><span class="s3">LTRootElement</span></p>
<p class="p5"><span class="s3">{</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">override</span><span class="s1"> </span><span class="s5">LTElementType</span><span class="s1"> </span><span class="s3">GetLTElementType</span><span class="s1">()</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s1"> </span><span class="s3">LTElementType</span><span class="s1">.</span><span class="s3">Box</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p12"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s3">public</span><span class="s1"> </span><span class="s3">override</span><span class="s1"> </span><span class="s5">LTElement</span><span class="s1">[] </span><span class="s7">GetLTElements</span><span class="s1">()</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s3"> </span><span class="s4">elements</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s2">private</span><span class="s3"> </span><span class="s5">LTElement</span><span class="s3">[] </span><span class="s4">elements</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s5">Image</span><span class="s1"> </span><span class="s4">BGImage</span><span class="s1">;</span><span class="s3">// </span><span class="s8">背景画像、</span><span class="s3">9</span><span class="s8">パッチにすると良さそう</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">static</span><span class="s1"> </span><span class="s3">BoxElement</span><span class="s1"> </span><span class="s7">GO</span><span class="s1">(</span><span class="s3">Image</span><span class="s1"> </span><span class="s4">bg</span><span class="s1">, </span><span class="s2">params</span><span class="s1"> </span><span class="s3">LTElement</span><span class="s1">[] </span><span class="s4">elements</span><span class="s1">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s4">prefabName</span><span class="s1"> = </span><span class="s3">"LayouTaroPrefabs/Box"</span><span class="s1">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">res</span><span class="s1"> = </span><span class="s3">Resources</span><span class="s1">.</span><span class="s7">Load</span><span class="s1">(</span><span class="s3">prefabName</span><span class="s1">) </span><span class="s2">as</span><span class="s1"> </span><span class="s5">GameObject</span><span class="s1">;</span></p>
<p class="p6"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s4">r</span><span class="s1"> = </span><span class="s3">Instantiate</span><span class="s1">(</span><span class="s4">res</span><span class="s1">).</span><span class="s3">AddComponent</span><span class="s1">&lt;</span><span class="s5">BoxElement</span><span class="s1">&gt;();</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">r</span><span class="s3">.</span><span class="s4">BGImage</span><span class="s3"> = </span><span class="s4">bg</span><span class="s3">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">r</span><span class="s1">.</span><span class="s3">elements</span><span class="s1"> = </span><span class="s3">elements</span><span class="s1">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">return</span><span class="s3"> </span><span class="s4">r</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s3">}</span></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3">3. UIの生成とレイアウト</p>
<p class="p13"><span class="s9"><span class="Apple-tab-span">	</span></span>独自定義した要素を生成、Rootを親として子供要素をガンガン入れる。</p>
<p class="p14"><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">データ構造を作る、自由に構造を書いていい。</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">box</span><span class="s3"> = </span><span class="s4">BoxElement</span><span class="s3">.</span><span class="s7">GO</span><span class="s3">(</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s2">null</span><span class="s3">,</span><span class="s11">// bg</span><span class="s12">画像</span></p>
<p class="p10"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s4">TextElement</span><span class="s1">.</span><span class="s7">GO</span><span class="s1">(</span><span class="s3">"hannin is yasu! this is public problem! gooooooooooooood"</span><span class="s1">),</span><span class="s11">// </span><span class="s12">テキスト</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s4">ImageElement</span><span class="s3">.</span><span class="s7">GO</span><span class="s3">(</span><span class="s2">null</span><span class="s3">)</span><span class="s11">// </span><span class="s12">画像</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>);</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">レイアウトに使うクラスを生成する</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">layouter</span><span class="s3"> = </span><span class="s2">new</span><span class="s3"> </span><span class="s5">MyLayouter</span><span class="s3">();</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">コンテンツのサイズをセットする</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">size</span><span class="s3"> = </span><span class="s2">new</span><span class="s3"> </span><span class="s5">Vector2</span><span class="s3">(</span><span class="s13">200</span><span class="s3">, </span><span class="s13">100</span><span class="s3">);</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">// </span><span class="s8">レイアウトを行う</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">go</span><span class="s1"> = </span><span class="s3">box</span><span class="s1">.</span><span class="s3">gameObject</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">go</span><span class="s3"> = </span><span class="s4">LayouTaro</span><span class="s3">.</span><span class="s7">Layout</span><span class="s3">&lt;</span><span class="s5">BoxElement</span><span class="s3">&gt;(</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s4">canvas</span><span class="s1">.</span><span class="s4">transform</span><span class="s1">,</span><span class="s3">// </span><span class="s8">レイアウトしたものを置く親のTransform</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">            </span></span><span class="s14">size</span><span class="s9">,</span><span class="s10">// </span><span class="s3">レイアウトするビューのサイズ。横幅はそのまま、縦に延びるのを想定している。</span></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">            </span></span><span class="s14">go</span><span class="s9">,</span><span class="s10">// LTRootElement</span><span class="s3">型を継承している</span><span class="s10">T</span><span class="s3">型のComponentがセットされているGameObjectを指定する</span></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s4">layouter</span><span class="s3">// </span><span class="s8">レイアウトに使用する操作法をセット</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>);</span></p>
<p class="p15"><span class="s3"></span><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>こうして生成された、自由な順番 + 内容でLTElementを含んだboxと、自由にレイアウトを記述できるILayouterを拡張したMyLayouterのインスタンス、そして</p>
<p class="p13"><span class="Apple-tab-span">	</span>コンテンツをレイアウトするためのサイズを用意する。</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>最終的に LayouTaro.Layout&lt;LTRootElement型&gt; メソッドを実行すると、LTRootElementを拡張した型のGameObjectの中身がレイアウトされる。</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>上のやつだと、</p>
<p class="p13"><span class="Apple-tab-span">	</span>・幅200のコンテンツに、BoxElementを親として、子コンテンツとしてText(犯人はヤス)、Image(null)がレイアウトされる</p>
<p class="p13"><span class="Apple-tab-span">	</span>という感じになる。</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p13"><b>レイアウトコード</b></p>
<p class="p13"><span class="Apple-tab-span">	</span>ILayouterを実装したクラスのメソッドがレイアウト時に自動的に呼ばれる。</p>
<p class="p13"><span class="Apple-tab-span">	</span>そこで、自力で種類単位でのレイアウトをしてもよし、予め用意されているBasicLayoutFunctionsを利用することも可能。</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>ILayouterには次の2つのメソッドが定義されている。</p>
<p class="p14"><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>Layout関数はLayouTaroのLayout関数から呼ばれる。 コンテンツのレイアウトをTypeEnumごとに事細かく描くことができる。</p>
<p class="p7"><span class="s2">public</span><span class="s1"> </span><span class="s2">void</span><span class="s1"> </span><span class="s7">Layout</span><span class="s1">(</span><span class="s5">Vector2</span><span class="s1"> </span><span class="s3">viewSize</span><span class="s1">, </span><span class="s2">out</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">originX</span><span class="s1">, </span><span class="s2">out</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">originY</span><span class="s1">, </span><span class="s5">GameObject</span><span class="s1"> </span><span class="s3">rootObject</span><span class="s1">, </span><span class="s5">LTRootElement</span><span class="s1"> </span><span class="s3">rootElement</span><span class="s1">, </span><span class="s5">LTElement</span><span class="s1">[] </span><span class="s3">elements</span><span class="s1">, </span><span class="s2">ref</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">currentLineMaxHeight</span><span class="s1">, </span><span class="s2">ref</span><span class="s1"> </span><span class="s5">List</span><span class="s1">&lt;</span><span class="s5">RectTransform</span><span class="s1">&gt; </span><span class="s3">lineContents</span><span class="s1">)</span></p>
<p class="p15"><span class="s3"></span><br></p>
<p class="p15"><span class="s3"></span><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>UpdateValues関数はLayouTaroのRelayoutWithUpdate関数から呼ばれる。 レイアウト済みのオブジェクトに対し、任意の値をセットすることができる。</p>
<p class="p4"><span class="s2">public</span><span class="s1"> </span><span class="s2">void</span><span class="s1"> </span><span class="s7">UpdateValues</span><span class="s1">(</span><span class="s3">LTElement</span><span class="s1">[] </span><span class="s4">elements</span><span class="s1">, </span><span class="s3">Dictionary</span><span class="s1">&lt;</span><span class="s3">LTElementType</span><span class="s1">, </span><span class="s2">object</span><span class="s1">&gt; </span><span class="s4">updateValues</span><span class="s1">)</span></p>
<p class="p15"><span class="s3"></span><br></p>
<p class="p15"><span class="s3"></span><br></p>
<p class="p13"><span class="Apple-tab-span">	</span>試しにLayouterを実装してみた場合の全体は以下のようになる。 ILayouterを継承している。</p>
<p class="p4"><span class="s2">public</span><span class="s1"> </span><span class="s2">class</span><span class="s1"> </span><span class="s3">MyLayouter</span><span class="s1"> : </span><span class="s3">ILayouter</span></p>
<p class="p5"><span class="s3">{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span></span><span class="s11">/*</span></p>
<p class="p11"><span class="s10"><span class="Apple-converted-space">        </span></span><span class="s3">子要素をレイアウトし、親要素が余白ありでそれを包む。</span></p>
<p class="p9"><span class="s3"><span class="Apple-converted-space">    </span>*/</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">void</span><span class="s1"> </span><span class="s7">Layout</span><span class="s1">(</span><span class="s5">Vector2</span><span class="s1"> </span><span class="s3">viewSize</span><span class="s1">, </span><span class="s2">out</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">originX</span><span class="s1">, </span><span class="s2">out</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">originY</span><span class="s1">, </span><span class="s5">GameObject</span><span class="s1"> </span><span class="s3">rootObject</span><span class="s1">, </span><span class="s5">LTRootElement</span><span class="s1"> </span><span class="s3">rootElement</span><span class="s1">, </span><span class="s5">LTElement</span><span class="s1">[] </span><span class="s3">elements</span><span class="s1">, </span><span class="s2">ref</span><span class="s1"> </span><span class="s2">float</span><span class="s1"> </span><span class="s3">currentLineMaxHeight</span><span class="s1">, </span><span class="s2">ref</span><span class="s1"> </span><span class="s5">List</span><span class="s1">&lt;</span><span class="s5">RectTransform</span><span class="s1">&gt; </span><span class="s3">lineContents</span><span class="s1">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">OutsideSpacing</span><span class="s1"> = </span><span class="s13">10f</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">originX</span><span class="s3"> = </span><span class="s13">0f</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s4">originY</span><span class="s3"> = </span><span class="s13">0f</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">originalViewWidth</span><span class="s1"> = </span><span class="s3">viewSize</span><span class="s1">.</span><span class="s3">x</span><span class="s1">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">viewWidth</span><span class="s1"> = </span><span class="s3">viewSize</span><span class="s1">.</span><span class="s3">x</span><span class="s1"> - </span><span class="s3">OutsideSpacing</span><span class="s1"> * </span><span class="s13">2</span><span class="s1">;</span><span class="s11">// </span><span class="s12">左右の余白分を引く</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// MyLayput</span><span class="s3">は</span><span class="s10">root</span><span class="s3">として</span><span class="s10">box</span><span class="s3">がくる前提で作られている、という想定のサンプル</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">root</span><span class="s3"> = </span><span class="s4">rootObject</span><span class="s3">.</span><span class="s7">GetComponent</span><span class="s3">&lt;</span><span class="s5">BoxElement</span><span class="s3">&gt;();</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">rootTrans</span><span class="s3"> = </span><span class="s4">root</span><span class="s3">.</span><span class="s7">GetComponent</span><span class="s3">&lt;</span><span class="s5">RectTransform</span><span class="s3">&gt;();</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">for</span><span class="s3"> (</span><span class="s2">var</span><span class="s3"> </span><span class="s4">i</span><span class="s3"> = </span><span class="s13">0</span><span class="s3">; </span><span class="s4">i</span><span class="s3"> &lt; </span><span class="s4">elements</span><span class="s3">.</span><span class="s4">Length</span><span class="s3">; </span><span class="s4">i</span><span class="s3">++)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">element</span><span class="s3"> = </span><span class="s4">elements</span><span class="s3">[</span><span class="s4">i</span><span class="s3">];</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">currentElementRectTrans</span><span class="s1"> = </span><span class="s3">element</span><span class="s1">.</span><span class="s7">GetComponent</span><span class="s1">&lt;</span><span class="s5">RectTransform</span><span class="s1">&gt;();</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">restWidth</span><span class="s1"> = </span><span class="s3">viewWidth</span><span class="s1"> - </span><span class="s3">originX</span><span class="s1">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">lineContents</span><span class="s1">.</span><span class="s7">Add</span><span class="s1">(</span><span class="s3">currentElementRectTrans</span><span class="s1">);</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">type</span><span class="s3"> = </span><span class="s4">element</span><span class="s3">.</span><span class="s7">GetLTElementType</span><span class="s3">();</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s6">switch</span><span class="s3"> (</span><span class="s4">type</span><span class="s3">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Image</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">imageElement</span><span class="s3"> = (</span><span class="s5">ImageElement</span><span class="s3">)</span><span class="s4">element</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">BasicLayoutFunctions</span><span class="s3">.</span><span class="s7">RectLayout</span><span class="s3">(</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">imageElement</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">currentElementRectTrans</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">imageElement</span><span class="s3">.</span><span class="s7">RectSize</span><span class="s3">(),</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originX</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originY</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">restWidth</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">currentLineMaxHeight</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">lineContents</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span>);</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Text</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">newTailTextElement</span><span class="s3"> = (</span><span class="s5">TextElement</span><span class="s3">)</span><span class="s4">element</span><span class="s3">;</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">contentText</span><span class="s1"> = </span><span class="s3">newTailTextElement</span><span class="s1">.</span><span class="s7">Text</span><span class="s1">();</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">BasicLayoutFunctions</span><span class="s3">.</span><span class="s7">TextLayout</span><span class="s3">(</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">newTailTextElement</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">contentText</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">currentElementRectTrans</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">viewWidth</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originX</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originY</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">restWidth</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">currentLineMaxHeight</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">lineContents</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span>);</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Button</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">buttonElement</span><span class="s3"> = (</span><span class="s5">ButtonElement</span><span class="s3">)</span><span class="s4">element</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">BasicLayoutFunctions</span><span class="s3">.</span><span class="s7">RectLayout</span><span class="s3">(</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">buttonElement</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">currentElementRectTrans</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s4">buttonElement</span><span class="s3">.</span><span class="s7">RectSize</span><span class="s3">(),</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originX</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">originY</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">restWidth</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">currentLineMaxHeight</span><span class="s3">,</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                        </span></span><span class="s2">ref</span><span class="s3"> </span><span class="s4">lineContents</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span>);</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Box</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">throw</span><span class="s3"> </span><span class="s2">new</span><span class="s3"> </span><span class="s5">Exception</span><span class="s3">(</span><span class="s15">"unsupported layout:"</span><span class="s3"> + </span><span class="s4">type</span><span class="s3">);</span><span class="s11">// </span><span class="s12">子のレイヤーに</span><span class="s11">Box</span><span class="s12">が来るのを許可しない。</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">default</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">Debug</span><span class="s3">.</span><span class="s7">LogError</span><span class="s3">(</span><span class="s15">"unsupported element type:"</span><span class="s3"> + </span><span class="s4">type</span><span class="s3">);</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p11"><span class="s9"><span class="Apple-converted-space">        </span></span><span class="s10">// </span><span class="s3">最終行のレイアウトを行う</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">BasicLayoutFunctions</span><span class="s1">.</span><span class="s7">LayoutLastLine</span><span class="s1">(</span><span class="s2">ref</span><span class="s1"> </span><span class="s3">originY</span><span class="s1">, </span><span class="s3">currentLineMaxHeight</span><span class="s1">, </span><span class="s2">ref</span><span class="s1"> </span><span class="s3">lineContents</span><span class="s1">);</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">// </span><span class="s8">サイズを調整する</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">rootTrans</span><span class="s1">.</span><span class="s3">sizeDelta</span><span class="s1"> = </span><span class="s2">new</span><span class="s1"> </span><span class="s5">Vector2</span><span class="s1">(</span><span class="s3">originalViewWidth</span><span class="s1">, </span><span class="s3">Mathf</span><span class="s1">.</span><span class="s7">Abs</span><span class="s1">(</span><span class="s3">originY</span><span class="s1">) + </span><span class="s3">OutsideSpacing</span><span class="s1"> * </span><span class="s13">2</span><span class="s1">);</span><span class="s11">// </span><span class="s12">オリジナル幅で、高さに対して</span><span class="s11">2</span><span class="s12">倍分の余白を足す。</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">        </span></span><span class="s3">// </span><span class="s8">子要素の余白分の移動</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">foreach</span><span class="s3"> (</span><span class="s2">var</span><span class="s3"> </span><span class="s4">e</span><span class="s3"> </span><span class="s6">in</span><span class="s3"> </span><span class="s4">elements</span><span class="s3">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">rectTrans</span><span class="s3"> = </span><span class="s4">e</span><span class="s3">.</span><span class="s7">GetComponent</span><span class="s3">&lt;</span><span class="s5">RectTransform</span><span class="s3">&gt;();</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">            </span></span><span class="s3">rectTrans</span><span class="s1">.</span><span class="s3">anchoredPosition</span><span class="s1"> = </span><span class="s2">new</span><span class="s1"> </span><span class="s5">Vector2</span><span class="s1">(</span><span class="s3">rectTrans</span><span class="s1">.</span><span class="s3">anchoredPosition</span><span class="s1">.</span><span class="s3">x</span><span class="s1"> + </span><span class="s3">OutsideSpacing</span><span class="s1">, </span><span class="s3">rectTrans</span><span class="s1">.</span><span class="s3">anchoredPosition</span><span class="s1">.</span><span class="s3">y</span><span class="s1"> - </span><span class="s3">OutsideSpacing</span><span class="s1">);</span><span class="s11">// </span><span class="s12">ルートの下のエレメントの要素をスペース分移動する。</span><span class="s11">y</span><span class="s12">は</span><span class="s11">-</span><span class="s12">なので</span><span class="s11">-</span><span class="s12">する。</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">    </span></span><span class="s2">public</span><span class="s1"> </span><span class="s2">void</span><span class="s1"> </span><span class="s7">UpdateValues</span><span class="s1">(</span><span class="s3">LTElement</span><span class="s1">[] </span><span class="s4">elements</span><span class="s1">, </span><span class="s3">Dictionary</span><span class="s1">&lt;</span><span class="s3">LTElementType</span><span class="s1">, </span><span class="s2">object</span><span class="s1">&gt; </span><span class="s4">updateValues</span><span class="s1">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span></span><span class="s6">foreach</span><span class="s3"> (</span><span class="s2">var</span><span class="s3"> </span><span class="s4">e</span><span class="s3"> </span><span class="s6">in</span><span class="s3"> </span><span class="s4">elements</span><span class="s3">)</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span></span><span class="s6">switch</span><span class="s3"> (</span><span class="s4">e</span><span class="s3">.</span><span class="s7">GetLTElementType</span><span class="s3">())</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span>{</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Image</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">i</span><span class="s3"> = (</span><span class="s5">ImageElement</span><span class="s3">)</span><span class="s4">e</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">// get value from updateValues and cast to the type what you set.</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">p</span><span class="s1"> = </span><span class="s3">updateValues</span><span class="s1">[</span><span class="s3">LTElementType</span><span class="s1">.</span><span class="s3">Image</span><span class="s1">] </span><span class="s2">as</span><span class="s1"> </span><span class="s5">Image</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">i</span><span class="s3">.</span><span class="s4">Image</span><span class="s3"> = </span><span class="s4">p</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">case</span><span class="s3"> </span><span class="s4">LTElementType</span><span class="s3">.</span><span class="s4">Text</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s3"> </span><span class="s4">t</span><span class="s3"> = (</span><span class="s5">TextElement</span><span class="s3">)</span><span class="s4">e</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p9"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s3">// get value from updateValues and cast to the type what you set.</span></p>
<p class="p7"><span class="s1"><span class="Apple-converted-space">                    </span></span><span class="s2">var</span><span class="s1"> </span><span class="s3">tVal</span><span class="s1"> = </span><span class="s3">updateValues</span><span class="s1">[</span><span class="s3">LTElementType</span><span class="s1">.</span><span class="s3">Text</span><span class="s1">] </span><span class="s2">as</span><span class="s1"> </span><span class="s2">string</span><span class="s1">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s4">t</span><span class="s3">.</span><span class="s4">TextContent</span><span class="s3"> = </span><span class="s4">tVal</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p8"><span class="s3"></span><br></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                </span></span><span class="s6">default</span><span class="s3">:</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">                    </span></span><span class="s6">break</span><span class="s3">;</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p5"><span class="s3"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p5"><span class="s3">}</span></p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p13"><b>実例</b></p>
<p class="p16"><span class="s16"><span class="Apple-tab-span">	</span></span><img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202020-03-24%2018.14.10.png" alt="スクリーンショット 2020-03-24 18.14.10.png"></p>
<p class="p13"><span class="s17"><span class="Apple-tab-span">	</span></span>こんな感じのレイアウトができたりする。はい。</p>
<p class="p14"><br></p>
<p class="p14"><br></p>
<p class="p13">いい感じ。</p>
</body>
</html>
