<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1265.19">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; background-color: #ebebeb}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; background-color: #ebebeb; min-height: 18.0px}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>nginxをMac OSで動かす</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>brewで下記に入る。</p>
<p class="p4">/usr/local/Cellar/nginx/VERSION_OF_INSTALLED</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>設定</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>下記にできる。</p>
<p class="p4">/usr/local/etc/nginx/nginx.conf</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>単純なHTMLファイルをホスト</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>docrootはインストール時に/usr/local/var/wwwだよって言われてるんだけど、wwwはどことも繋がってない。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>また、インストール場所のフォルダにhtmフォルダへのリンクが置いてあるけど、これも繋がってない。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>インストール時に作られてるこれらのlinkは失敗してる模様。</p>
<p class="p4">/usr/local/var/www</p>
<p class="p4">/usr/local/Cellar/nginx/VERSION_OF_INSTALLED/html</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>んで、htmlシンボリックリンクを作り直す。</p>
<p class="p2"><b></b><br></p>
<p class="p2"><b></b><br></p>
<p class="p4">/Users/USER/Public/index.html</p>
<p class="p3"><span class="Apple-tab-span">	</span>とかにファイルを置いて、VERSION_OF_INSTALLEDフォルダからリンクを作成しなおせばOK。</p>
<p class="p2"><br></p>
<p class="p4">ln -s /Users/USER/Public</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>設定ファイルサンプル</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>httpとWebSocketプロキシ。</p>
<p class="p2"><br></p>
<p class="p3">nginx.conf</p>
<p class="p4">#user<span class="Apple-converted-space">  </span>nobody;</p>
<p class="p4">worker_processes<span class="Apple-converted-space">  </span>1;</p>
<p class="p5"><br></p>
<p class="p4">#error_log<span class="Apple-converted-space">  </span>logs/error.log;</p>
<p class="p4">#error_log<span class="Apple-converted-space">  </span>logs/error.log<span class="Apple-converted-space">  </span>notice;</p>
<p class="p4">#error_log<span class="Apple-converted-space">  </span>logs/error.log<span class="Apple-converted-space">  </span>info;</p>
<p class="p5"><br></p>
<p class="p4">#pid<span class="Apple-converted-space">        </span>logs/nginx.pid;</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4">events {</p>
<p class="p4"><span class="Apple-converted-space">    </span>worker_connections<span class="Apple-converted-space">  </span>1024;</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4">http {</p>
<p class="p4"><span class="Apple-converted-space">    </span>include <span class="Apple-converted-space">      </span>mime.types;</p>
<p class="p4"><span class="Apple-converted-space">    </span>default_type<span class="Apple-converted-space">  </span>application/octet-stream;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#log_format<span class="Apple-converted-space">  </span>main<span class="Apple-converted-space">  </span>'$remote_addr - $remote_user [$time_local] "$request" '</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">                  </span>'$status $body_bytes_sent "$http_referer" '</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">                  </span>'"$http_user_agent" "$http_x_forwarded_for"';</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#access_log<span class="Apple-converted-space">  </span>logs/access.log<span class="Apple-converted-space">  </span>main;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>sendfile<span class="Apple-converted-space">        </span>on;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#tcp_nopush <span class="Apple-converted-space">    </span>on;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#keepalive_timeout<span class="Apple-converted-space">  </span>0;</p>
<p class="p4"><span class="Apple-converted-space">    </span>keepalive_timeout<span class="Apple-converted-space">  </span>65;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#gzip<span class="Apple-converted-space">  </span>on;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>server {</p>
<p class="p4"><span class="Apple-converted-space">        </span>listen <span class="Apple-converted-space">      </span>8080;</p>
<p class="p4"><span class="Apple-converted-space">        </span>server_name<span class="Apple-converted-space">  </span>localhost;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>#charset koi8-r;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>#access_log<span class="Apple-converted-space">  </span>logs/host.access.log<span class="Apple-converted-space">  </span>main;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>location / {</p>
<p class="p4"><span class="Apple-converted-space">            </span>root <span class="Apple-converted-space">  </span>html;</p>
<p class="p4"><span class="Apple-converted-space">            </span>index<span class="Apple-converted-space">  </span>index.html index.htm;</p>
<p class="p4"><span class="Apple-converted-space">        </span>}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>#error_page<span class="Apple-converted-space">  </span>404<span class="Apple-converted-space">              </span>/404.html;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span># redirect server error pages to the static page /50x.html</p>
<p class="p4"><span class="Apple-converted-space">        </span>#</p>
<p class="p4"><span class="Apple-converted-space">        </span>error_page <span class="Apple-converted-space">  </span>500 502 503 504<span class="Apple-converted-space">  </span>/50x.html;</p>
<p class="p4"><span class="Apple-converted-space">        </span>location = /50x.html {</p>
<p class="p4"><span class="Apple-converted-space">            </span>root <span class="Apple-converted-space">  </span>html;</p>
<p class="p4"><span class="Apple-converted-space">        </span>}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span># proxy the PHP scripts to Apache listening on 127.0.0.1:80</p>
<p class="p4"><span class="Apple-converted-space">        </span>#</p>
<p class="p4"><span class="Apple-converted-space">        </span>#location ~ \.php$ {</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>proxy_pass <span class="Apple-converted-space">  </span>http://127.0.0.1;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</p>
<p class="p4"><span class="Apple-converted-space">        </span>#</p>
<p class="p4"><span class="Apple-converted-space">        </span>#location ~ \.php$ {</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>root <span class="Apple-converted-space">          </span>html;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>fastcgi_pass <span class="Apple-converted-space">  </span>127.0.0.1:9000;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>fastcgi_index<span class="Apple-converted-space">  </span>index.php;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>fastcgi_param<span class="Apple-converted-space">  </span>SCRIPT_FILENAME<span class="Apple-converted-space">  </span>/scripts$fastcgi_script_name;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>include<span class="Apple-converted-space">        </span>fastcgi_params;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span># deny access to .htaccess files, if Apache's document root</p>
<p class="p4"><span class="Apple-converted-space">        </span># concurs with nginx's one</p>
<p class="p4"><span class="Apple-converted-space">        </span>#</p>
<p class="p4"><span class="Apple-converted-space">        </span>#location ~ /\.ht {</p>
<p class="p4"><span class="Apple-converted-space">        </span>#<span class="Apple-converted-space">    </span>deny<span class="Apple-converted-space">  </span>all;</p>
<p class="p4"><span class="Apple-converted-space">        </span>#}</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span># another virtual host using mix of IP-, name-, and port-based configuration</p>
<p class="p4"><span class="Apple-converted-space">    </span>#</p>
<p class="p4"><span class="Apple-converted-space">    </span>#server {</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>listen <span class="Apple-converted-space">      </span>8000;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>listen <span class="Apple-converted-space">      </span>somename:8080;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>server_name<span class="Apple-converted-space">  </span>somename<span class="Apple-converted-space">  </span>alias<span class="Apple-converted-space">  </span>another.alias;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>location / {</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">        </span>root <span class="Apple-converted-space">  </span>html;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">        </span>index<span class="Apple-converted-space">  </span>index.html index.htm;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>#}</p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span># HTTPS server</p>
<p class="p4"><span class="Apple-converted-space">    </span>#</p>
<p class="p4"><span class="Apple-converted-space">    </span>#server {</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>listen <span class="Apple-converted-space">      </span>443 ssl;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>server_name<span class="Apple-converted-space">  </span>localhost;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_certificate<span class="Apple-converted-space">      </span>cert.pem;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_certificate_key<span class="Apple-converted-space">  </span>cert.key;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_session_cache<span class="Apple-converted-space">    </span>shared:SSL:1m;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_session_timeout<span class="Apple-converted-space">  </span>5m;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_ciphers<span class="Apple-converted-space">  </span>HIGH:!aNULL:!MD5;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>ssl_prefer_server_ciphers<span class="Apple-converted-space">  </span>on;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>location / {</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">        </span>root <span class="Apple-converted-space">  </span>html;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">        </span>index<span class="Apple-converted-space">  </span>index.html index.htm;</p>
<p class="p4"><span class="Apple-converted-space">    </span>#<span class="Apple-converted-space">    </span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>#}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">    </span>server {</p>
<p class="p4"><span class="Apple-converted-space">        </span>listen <span class="Apple-converted-space">      </span>8081;</p>
<p class="p4"><span class="Apple-converted-space">        </span>server_name<span class="Apple-converted-space">  </span>localhost;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>proxy_read_timeout 500s;</p>
<p class="p5"><span class="Apple-converted-space">        </span></p>
<p class="p4"><span class="Apple-converted-space">        </span>#charset koi8-r;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>#access_log<span class="Apple-converted-space">  </span>logs/host.access.log<span class="Apple-converted-space">  </span>main;</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">        </span>location / {</p>
<p class="p4"><span class="Apple-converted-space">            </span>proxy_pass http://127.0.0.1:8081/;</p>
<p class="p4"><span class="Apple-converted-space">            </span>proxy_http_version 1.1;</p>
<p class="p4"><span class="Apple-converted-space">            </span>proxy_set_header Upgrade $http_upgrade;</p>
<p class="p4"><span class="Apple-converted-space">            </span>proxy_set_header Connection "upgrade";</p>
<p class="p4"><span class="Apple-converted-space">        </span>}</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p5"><br></p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
</body>
</html>
