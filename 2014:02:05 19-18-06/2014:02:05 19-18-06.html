<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1187.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>Sublime Text のプラグイン書いてたらテストツールができてたよみたいな話</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>Sublime Text のプラグインでSublimeSocketってのを作ってサーバと繋いだりして遊んでるんだけど、</p>
<p class="p3"><span class="Apple-tab-span">	</span>それの簡易なテスト環境作って放置しておいたら、弄られて凄い事になってた。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><b>様子</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>テストスイートを実行、内容に則ってエディタ側がとてもキモい動きをする。</p>
<iframe src="https://player.vimeo.com/video/85882769?autoplay=1" width="500" height="280" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>解説</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>JSONを内包したオレオレDSLで、SublimeSocket APIのテストを書く。</p>
<p class="p3"><span class="Apple-tab-span">	</span>それらを.sst拡張子のファイルにまとめて、テストスイートとして実行。</p>
<p class="p3"><span class="Apple-tab-span">	</span>エディタ側に対して、テストスイートの各１件ずつが実行される。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>フィルタをセット→フィルタに文字列を送る→hitしたらAPIを実行、</p>
<p class="p3"><span class="Apple-tab-span">	</span>ファイルを作る→ファイルに書き込む→消す、</p>
<p class="p3"><span class="Apple-tab-span">	</span>ファイルを作る→ファイルの特定箇所を選択する、</p>
<p class="p3"><span class="Apple-tab-span">	</span>ファイルを作る→ファイルの特定箇所を選択する→書き込む、</p>
<p class="p3"><span class="Apple-tab-span">	</span>バッファを作る→バッファの特定箇所を選択する→書き込む、</p>
<p class="p3"><span class="Apple-tab-span">	</span>ダイアログを出す、</p>
<p class="p3"><span class="Apple-tab-span">	</span>ツールチップを出す、</p>
<p class="p3"><span class="Apple-tab-span">	</span>以上を連鎖させたり連動させたり。<span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>入力側から最終出力される値までで管理し、assertなどでチェック、結果比較をしている。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>Sublime側に対してどうしても人間がキー入力する必要がある部分(GUI、ツールチップ選択など)があり、</p>
<p class="p3"><span class="Apple-tab-span">	</span>そのあたりは今のところ手で押している。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>ムービー中で流れているテストは90件くらい。オールグリーンヤッター！</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><b>今後</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>テストスイートが作られた段階で、SublimeSocketのAPIはSublime TextのAPIを仮想化していて、</p>
<p class="p3"><span class="Apple-tab-span">	</span>他のエディタでの同様の機構を呼び出す事も可能になっていた。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>とりあえずVim版とかLightTable版を書いてみようかな。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
</body>
</html>
