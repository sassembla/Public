<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1348.17">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 17.0px 'Hiragino Kaku Gothic ProN'}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>CEDEC2015 Day2 メモとか</b></p>
<p class="p2"><b></b><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>メモ</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4"><b>GPGPUを活用した剛体シミュレーション最適化事例</b></p>
<p class="p2"><br></p>
<p class="p3"><b>GPUが得意なこと</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>特殊効果的なやつ</p>
<p class="p3"><span class="Apple-tab-span">	</span>物量で賑やかな画面を演出する</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>精度はそこそこなんだけど大量。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>拘束ソルバーって何</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>衝突検出、反発力計算、移動</p>
<p class="p3"><span class="Apple-tab-span">	</span>Collision Detection, Constraint Solver, Integration</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>これのConstraint Solverのところ。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>A,B,Cの三つの物体がぶつかる時、A-B,B-C,C-A間で、全ての物体同士が貫通しない、というような三つの拘束に対しての解が欲しい</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>→<b>ヤコビ法</b>、<b>ガウズザイデル法</b>とかで解ける。ただし不等式がふくまれるので、一意にならない。ので、反復解法というのを使う</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>解決条件を満たしている解λを0~無限の範囲でクランプ(保持？)</p>
<p class="p3"><span class="Apple-tab-span">	</span>0に近い値を望む。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>拘束式</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>CEDEC 2008 物理エンジンの作り方</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>というのがあるのでみよう。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>ヤコビアン:変換マトリクス。速度を拘束軸上に変換する。</p>
<p class="p3"><span class="Apple-tab-span">	</span>拘束軸上？:衝突ポイント上に存在するベクトルみたいなものぽい</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>式の名前かな</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ガウスザイデル法を高速に解く</p>
<p class="p3"><span class="Apple-tab-span">	</span>A-B</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>B-C</p>
<p class="p3"><span class="Apple-tab-span">	</span>A<span class="Apple-tab-span">	</span>-<span class="Apple-tab-span">	</span>C</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>C-D</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>同じ剛体を共有しないものは個別に計算できる。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ヤコビ法について、</p>
<p class="p3"><span class="Apple-tab-span">	</span>並列にできる部分を上記のようにみなす方法をつかってみたところ、あんまりよくなかった。</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>・並列性の悪化</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>・並列化のためのコストがあった。。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>なんで？</p>
<p class="p3"><span class="Apple-tab-span">	</span>計算内容とその反映タイミングの問題。</p>
<p class="p3"><span class="Apple-tab-span">	</span>・ガウズザイデル法だと結果が収束する</p>
<p class="p3"><span class="Apple-tab-span">	</span>・ヤコビ法だと結果が発散する</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>なので、</p>
<p class="p3"><span class="Apple-tab-span">	</span>・ペア同士の計算はザイデル</p>
<p class="p3"><span class="Apple-tab-span">	</span>・ペア全体の計算はヤコビ</p>
<p class="p3"><span class="Apple-tab-span">	</span>と振ることで、計算量の削減をはかりつつ、、みたいな話</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ヤコビ法について</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SOR</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>SUR</p>
<p class="p3"><span class="Apple-tab-span">	</span>SURを適応するとデルタが小さくなって解が発散しにくくなる(解が定まりやすくなる</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>Weightみたいなパラメータを追加してSURとして適応する</p>
<p class="p3"><span class="Apple-tab-span">	</span>出し方いろいろ。とりあえずインデクシングしまくるみたいなかんじ。</p>
<p class="p2"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>Biasの追加</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>めりこんだぶんを速度に加える。</p>
<p class="p3"><span class="Apple-tab-span">	</span>貫通してる方向と深さに対して反発力を追加する、みたいな話</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>反復回数少なくてもいいかんじに動く、みたいなのが目標。</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><b>結論</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>・ガウスザイデル法より修正を加えたヤコビ速くて軽い</p>
<p class="p3"><span class="Apple-tab-span">	</span>・物量が増えてくるとだんだん同じような結果を出す感じになる</p>
<p class="p3"><span class="Apple-tab-span">	</span>・ただ量が増えてくるとメモリアクセスやらで減速する</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>メモリアクセス周り</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>流体、粒子ベースシミュレーションで得られた知見</p>
<p class="p3"><span class="Apple-tab-span">	</span>メモリアクセスの効率化</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><b>データ構造の変換による効率改善</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>Array of struct</p>
<p class="p3"><span class="Apple-tab-span">	</span>Struct of array</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>AOS:</p>
<p class="p3"><span class="Apple-tab-span">	</span>{</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pos</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>vel</p>
<p class="p3"><span class="Apple-tab-span">	</span>}</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>SOR:</p>
<p class="p3"><span class="Apple-tab-span">	</span>{</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>pos[N]</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>vel[N]</p>
<p class="p3"><span class="Apple-tab-span">	</span>}</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>SOAのほうがキャッシュヒット率良いよ(無駄なデータを読まないので</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><b>空間充填曲線をつかってメモリアクセス局在性の最適化</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>「もし座標上近い物体が隣接したメモリポイントに存在すれば、キャッシュヒット改善するんじゃね？」</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>テクスチャのピクセル配置に対して、<span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>swizzle化という処理を行うことで、テクスチャ座標上で近いテクスチャのポインタがそれぞれ隣接するといいなみたいな。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>空間充填曲線</p>
<p class="p3"><span class="Apple-tab-span">	</span>Z曲線</p>
<p class="p3"><span class="Apple-tab-span">	</span>ヒルベルト曲線とか</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>「スクリーン座標上でも近いピクセルは、テクスチャ上でも近い、みたいな法則を利用する。」</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>モートンコード<span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>・低コストで扱える空間充填曲線</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>メモリをソートした結果、3~4倍の高速化</p>
<p class="p3"><span class="Apple-tab-span">	</span>ソートにかかる処理の重さに比べて圧倒的に高速化のメリットが出る</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>なるほどな～～</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>モートンコードのコードはなんかサンプル見よう。</p>
<p class="p3"><span class="Apple-tab-span">	</span>hash gridとも相性がいい</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>ありあまる演算資源をどのように使い切るか</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>そうだAsyncShader使おうみたいな話</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4"><b>サブディビジョンサーフェスのすべてがわかる・グラフィックスエンジニア向け理論編</b></p>
<p class="p2"><br></p>
<p class="p3">資料発表が発表終了直後だったのでありがたくよみかえしている。</p>
<p class="p3"><span class="Apple-tab-span">	</span><a href="http://takahito-tejima.github.io">http://takahito-tejima.github.io</a></p>
<p class="p2"><br></p>
</body>
</html>
