<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1187.34">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>Unity 4.1でも性懲りも無くXcodeから作ったプロジェクトで起動してみる</b></p>
<p class="p2"><b></b><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span></b>モジュールのテストとかは、Xcodeで行いたい所存。</p>
<p class="p3"><span class="Apple-tab-span">	</span>テストが完了したらプラグイン化すればいいのだし。</p>
<p class="p3"><span class="Apple-tab-span">	</span>開発速度と繰り返しと苦楽の問題。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Unity 4.0からの変更点</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>・Unityの起動を任意のタイミングにすること→×</p>
<p class="p3"><span class="Apple-tab-span">	</span>・UnityとARCライブラリとかを共存させること→○</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>4.0で可能だった恐ろしいチートが不可能になった。正しい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>内容と経緯</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>4.0の時は、手製の設定でもって、Unity for iOS を</p>
<p class="p3"><span class="Apple-tab-span">	</span>Xcodeで作成したプロジェクトから実行する事が出来た。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>好きなときに好きなUnityプロジェクトを起動したり、</p>
<p class="p3"><span class="Apple-tab-span">	</span>XcodeでのObjective-Cのテストなどが可能だった。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>参考： <span class="Apple-tab-span">	</span><a href="http://sassembla.github.com/Public/2012:12:04%201-29-54/2012:12:04%201-29-54.html">UnityのiOS向けビルドを別アプリに含んで起動する</a></p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="http://sassembla.github.com/Public/2013:01:31%2017-47-32/2013:01:31%2017-47-32.html">Unityを自動的にビルドする設定にしたときのメモ</a></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>が、これが4.1から不可能になった。</p>
<p class="p3"><span class="Apple-tab-span">	</span>UnityのアプリケーションをiOS中から起動すると、Unityの初期化処理中にエラーで落ちる。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>もっとも、「穴だったから封じた」的なものではなく、</p>
<p class="p3"><span class="Apple-tab-span">	</span>プロファイラを充実させる過程で、スレッドの数に注目するようになり、</p>
<p class="p3"><span class="Apple-tab-span">	</span>その結果として、チェック機構のalloc過程ですでにthreadが存在する場合、mutexでエラーが起き、</p>
<p class="p3"><span class="Apple-tab-span">	</span>Unity起動中に落ちるようになった、というのが真実っぽい。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>Assertionで吹っ飛んでる節もないので、対策としていれた、と言うよりは、</p>
<p class="p3"><span class="Apple-tab-span">	</span>取得して来たデータを変更しようとして、すでに存在してるthreadとぶつかってるような印象。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ま、なんにせよ、試験目的を果たしたプロジェクトが、アップデートで使えなくなった、</p>
<p class="p3"><span class="Apple-tab-span">	</span>という状態に変わりなく。　それはそれでいい。正直好き放題出来すぎてた。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>たぶんがんばれば突破できる。</p>
<p class="p3"><span class="Apple-tab-span">	</span>でもがんばらない事に決めた。　テストする方法は残ってたから。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>というわけで代替法</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>1.Xcodeで新規プロジェクトを作成　ARCありでOK</p>
<p class="p3"><span class="Apple-tab-span">	</span>2.設定を調整(ぶっちゃけ以前の <a href="http://sassembla.github.com/Public/2012:12:04%201-29-54/2012:12:04%201-29-54.html">UnityのiOS向けビルドを別アプリに含んで起動する</a> の構成がそのまま使える。)</p>
<p class="p3"><span class="Apple-tab-span">	</span>3.Unity出力物をプロジェクトにぶち込む(-fno-objc-arc付与しまくり)</p>
<p class="p3"><span class="Apple-tab-span">	</span>4.main.mをmain.mmに書き換え、ARC使わない設定に変更(-fno-objc-arc付与)、Unity出力物のmain.mmを模倣。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>つまり、<b>KSUnityConnectorから接続していた部分は無かった事にする</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>何かARCを使う部品が存在する場合、</p>
<p class="p3"><span class="Apple-tab-span">	</span>Unity出力物の Classes/AppController.mm の startUnity 関数に書き足すと良いと思う。</p>
<p class="p3"><span class="Apple-tab-span">	</span>調子乗りすぎるとやっぱり怒られるけど。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>メリットの移り変わり</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>これでもまだメリットにまみれていて、</p>
<p class="p3"><span class="Apple-tab-span">	</span>XcodeでUnityプロジェクト自体のテストが実行可能。</p>
<p class="p3"><span class="Apple-tab-span">	</span>つまり、Jenkinsなどでの自動テストに関しては、まったくメリットが失われていない。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><b></b><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>デメリットは、どこまでいっても「標準のやり方ではない」事。</b></p>
<p class="p2"><b></b><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>自動テストが良いとこまで来たら、プラグイン化して、やっぱり人力でデバッグしような！　ケースを作るのは人間だ！</b></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>デバッガとかそういうのは仕込みまくる前提で。</b></p>
<p class="p2"><b></b><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>自動で出来るフェーズが存在するだけで、やり直し速度が格段にあがる。</p>
<p class="p3"><span class="Apple-tab-span">	</span>なにより自動化できるわけですし。おすし。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">すしくいてえ。</p>
</body>
</html>
