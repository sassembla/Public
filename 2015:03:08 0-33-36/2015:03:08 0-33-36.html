<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1265.21">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Kaku Gothic ProN'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; background-color: #ebebeb}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; background-color: #c0c0c0}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Kaku Gothic ProN'; background-color: #aaaaaa}
    span.s1 {background-color: #c0c0c0}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>addとdeserializeが低コストなログ用の形式が欲しい、、欲しくない？</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>まあ特殊なニーズなんですけど、ログを取るとき、追記可能でかつイザって時に</p>
<p class="p3"><span class="Apple-tab-span">	</span>特定の言語向けにdeserializeできる形式が欲しい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>用途</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>例えば、ログ自体からオブジェクト作り出して、実行可能な情報として動作させたい。</p>
<p class="p3"><span class="Apple-tab-span">	</span>んでその際、独自形式を作りたくない。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>現状</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>tomlが一番欲しい物に近いかなって思っている。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>例えばjsonでログを取る(この表現が既に狂気なのは承知してる)とかだと、</p>
<p class="p3"><span class="Apple-tab-span">	</span>次のようなログになるとして、</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">log.json</p>
<p class="p4">[</p>
<p class="p4"><span class="Apple-converted-space">    </span>{</p>
<p class="p4"><span class="Apple-converted-space">        </span>"key1": "val1",</p>
<p class="p4"><span class="Apple-converted-space">        </span>"key2": "val2",</p>
<p class="p4"><span class="Apple-converted-space">        </span>"date": "2015/03/0819: 58: 39"</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p4">]</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で、</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>追記するためには、とじカッコとかその辺がクソみたいな感じで邪魔になる。</p>
<p class="p2"><br></p>
<p class="p3">log.json</p>
<p class="p4">[</p>
<p class="p4"><span class="Apple-converted-space">    </span>{</p>
<p class="p4"><span class="Apple-converted-space">        </span>"key1": "val1",</p>
<p class="p4"><span class="Apple-converted-space">        </span>"key2": "val2",</p>
<p class="p4"><span class="Apple-converted-space">        </span>"date": "2015/03/0819: 58: 39"</p>
<p class="p4"><span class="Apple-converted-space">    </span>}<span class="s1">,</span></p>
<p class="p5"><span class="Apple-converted-space">    </span>{</p>
<p class="p5"><span class="Apple-converted-space">        </span>"key1": "val1",</p>
<p class="p5"><span class="Apple-converted-space">        </span>"key2": "val2",</p>
<p class="p5"><span class="Apple-converted-space">        </span>"date": "2015/03/0820: 00: 23"</p>
<p class="p5"><span class="Apple-converted-space">    </span>}</p>
<p class="p4">]</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>濃い部分が追記された内容。</p>
<p class="p3"><span class="Apple-tab-span">	</span>単純に改行 + α、、みたいな感じにはならない。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>正しくやるには、</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span><b>original -&gt; parse -&gt; add -&gt; serialize</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>みたいな行程を経ないといけない。</p>
<p class="p3"><span class="Apple-tab-span">	</span>こんなことでっかくなりつづけるファイルに対してやってられない。</p>
<p class="p2"><br></p>
<p class="p3"><b><span class="Apple-tab-span">	</span>original -&gt; add<span class="Apple-converted-space"> </span></b></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>だけで済み、かつdeserializeできる形式が欲しい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>tomlさん出番です</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>そのへんtomlさんは凄い。できる子。</p>
<p class="p2"><br></p>
<p class="p3">log.toml</p>
<p class="p4">[identity]</p>
<p class="p4">date = "2015/03/0819: 58: 39"</p>
<p class="p4">key1 = "val1"</p>
<p class="p4">key2 = "val2"</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>追記するとして</p>
<p class="p2"><br></p>
<p class="p3">log.toml</p>
<p class="p4">[identity]</p>
<p class="p4">date = "2015/03/0819: 58: 39"</p>
<p class="p4">key1 = "val1"</p>
<p class="p4">key2 = "val2"</p>
<p class="p6">[identity2]</p>
<p class="p6">date = "2015/03/0820: 00: 23"</p>
<p class="p6">key1 = "val1"</p>
<p class="p6">key2 = "val2"</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>とかにできる。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>まあ書き込みがアトム～な感じじゃないと成立しないのはどっちも一緒。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>identityに関しては、同じ対象であれば同じ値を使う、とかすると、deserialize時に折り畳まれる。時系列に並べたければ主キーをdate or 何かにすればいいのではという感じ。</p>
<p class="p3"><span class="Apple-tab-span">	</span>逆に、deserializeでshrinkされること自体が特性っちゃあ特性で、</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>時間を適当なインターバルでゾーン分けすると、特定のタイムスパンで起きた出来事を一気に見やすくできる。</p>
<p class="p3"><span class="Apple-tab-span">	</span>こんな感じ。</p>
<p class="p2"><br></p>
<p class="p4">[datezone]</p>
<p class="p4"><span class="Apple-converted-space">    </span>[datezone.id1]</p>
<p class="p4"><span class="Apple-converted-space">    </span>date = "2015/03/0820: 00: 23"</p>
<p class="p4"><span class="Apple-converted-space">    </span>key1 = "val1"</p>
<p class="p4"><span class="Apple-converted-space">    </span>key2 = "val2"</p>
<p class="p4">[datezone]</p>
<p class="p4"><span class="Apple-converted-space">    </span>[datezone.id2]</p>
<p class="p4"><span class="Apple-converted-space">    </span>date = "2015/03/0820: 00: 49"</p>
<p class="p4"><span class="Apple-converted-space">    </span>key1 = "val1"</p>
<p class="p4"><span class="Apple-converted-space">    </span>key2 = "val2"</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>datezoneは適当な[１分間以内に発生した物事の区分]とかにしたと仮定する。</p>
<p class="p3"><span class="Apple-tab-span">	</span>これはjsonだと下記と=になる。</p>
<p class="p2"><br></p>
<p class="p4">{</p>
<p class="p4"><span class="Apple-converted-space">  </span>"datezone": {</p>
<p class="p4"><span class="Apple-converted-space">    </span>"id1": {</p>
<p class="p4"><span class="Apple-converted-space">      </span>"date": "2015/03/0820: 00: 23",</p>
<p class="p4"><span class="Apple-converted-space">      </span>"key1": "val1",</p>
<p class="p4"><span class="Apple-converted-space">      </span>"key2": "val2"</p>
<p class="p4"><span class="Apple-converted-space">    </span>},</p>
<p class="p4"><span class="Apple-converted-space">    </span>"id2": {</p>
<p class="p4"><span class="Apple-converted-space">      </span>"date": "2015/03/0820: 00: 23",</p>
<p class="p4"><span class="Apple-converted-space">      </span>"key1": "val1",</p>
<p class="p4"><span class="Apple-converted-space">      </span>"key2": "val2"</p>
<p class="p4"><span class="Apple-converted-space">    </span>}</p>
<p class="p4"><span class="Apple-converted-space">  </span>}</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>書き込みやすさと情報量に対して、一気に差がつく感じ。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">どこかにメモっておきたかった。</p>
</body>
</html>
