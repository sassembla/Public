<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2022.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Sans'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; background-color: #e6e6e6}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; background-color: #e6e6e6; min-height: 18.0px}
    span.s1 {font: 12.0px 'Apple Color Emoji'}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>async await in swift 6</b></p>
<p class="p2"><br></p>
<p class="p3"><b>æ¦‚è¦</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>ã“ã‚Œã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><a href="https://speakerdeck.com/koher/await">https://speakerdeck.com/koher/await</a></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3">ä»¥ä¸‹æ›¸ãä¸‹ã—ã€‚</p>
<p class="p2"><br></p>
<p class="p3">ä»Šå¹´ã®ç§‹ã«ã¯ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œãã†ã¨ã®ã“ã¨ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒasync/awaitãŒå…¥ã‚‹ã¨ã“ã†ãªã‚‹ã‚ˆã¨ã€‚</p>
<p class="p4">func download(from url: URL, completion: @escaping (Data) -&gt; Void)</p>
<p class="p5"><br></p>
<p class="p4">download(from: url) { data in<span class="Apple-converted-space">Â </span></p>
<p class="p4"><span class="Apple-tab-span">	</span>// trailing closureã£ã¦ã„ã†åå‰ã ã£ãŸã‚“ã ãªã“ã‚Œ</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4">func download(from url: URL) async -&gt; Data</p>
<p class="p5"><br></p>
<p class="p4">let data = await donwload(from: url)</p>
<p class="p4">// ã“ã“ã§éåŒæœŸã‚’å—ã‘å–ã‚Œã‚‹</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">tryã¨throwsã®é–¢ä¿‚ã«ã«ã¦ã„ã‚‹ã­ãƒ¼ã£ã¦ã„ã†ã€‚</p>
<p class="p4">func foo() throws {}</p>
<p class="p5"><br></p>
<p class="p4">func bar() {</p>
<p class="p4"><span class="Apple-tab-span">	</span>try foo() // ã“ã‚Œã¯ãŠã“ã‚‰ã‚Œã‚‹ã€æ¤œæŸ»ä¾‹å¤–ãªã®ã‹ãª</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">Potential Suspension Point(ã£ã¦ä½• -&gt; ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå æœ‰ã•ã‚ŒãŸçŠ¶æ…‹ãŒè§£æ”¾ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒã‚¤ãƒ³ãƒˆ</p>
<p class="p2"><br></p>
<p class="p4">func donwload(from url: URL) async -&gt; Data</p>
<p class="p5"><br></p>
<p class="p4">func downloadImage(from url: URL) async -&gt; UIImage {</p>
<p class="p4"><span class="Apple-tab-span">	</span>// <b>Potential Suspension Point</b></p>
<p class="p4"><span class="Apple-tab-span">	</span>let data = await download(from: url)// ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå æœ‰ã•ã‚ŒãŸçŠ¶æ…‹ãŒè§£æ”¾ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãƒã‚¤ãƒ³ãƒˆã€ãªã‚‹ã»ã©</p>
<p class="p5"><span class="Apple-tab-span">	</span></p>
<p class="p4"><span class="Apple-tab-span">	</span>// ã“ã“ã‹ã‚‰å…ˆã¯ãœã‚“ãœã‚“åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹</p>
<p class="p4"><span class="Apple-tab-span">	</span>let image = UIImage(data: data)!</p>
<p class="p4"><span class="Apple-tab-span">	</span>return image</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-converted-space">Â </span>UIã‚¹ãƒ¬ãƒƒãƒ‰ã¸ã¨åæ˜ ã•ã›ã‚‹ã«ã¯åˆ¥ã®æ‰‹æ³•ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã‚“ã ã‚ã†ãªã€GCDã‹ãªã€‚ä»Šã¾ã§ã§ãã¦ãŸã“ã¨ã ã—ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>Promiseã‚„Futureã‚’è¿”ã•ãªã„ã®ã‹ï¼Ÿ</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>å‡ºã¦ã“ãªã„ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>ä¸€ç•ªè¿‘ã„ã®ã¯Kotlinã®SuspendFunc// ã“ã‚Œã¯ã¡ã‚‡ã£ã¨æ°—ã«ãªã‚‹</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>asyncã¨awaitã¯åˆ¥ã®å‹ã‚’è¿”ã—ã¦ã„ã‚‹ã€‚</p>
<p class="p4">func foo() {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var a:() async -&gt; Int = {42}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var b:() -&gt; Int = {42}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>a = b// ã“ã‚Œã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«é€šã‚‹ãŒã€é€†ã¯ç„¡ç†</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var c = await a()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>print(c)</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>// ã„ã„ãªï½ï½ï½ã“ã‚Œï½ï½ï½ã“ã‚ŒUnityã§ã‚‚ã‚„ã‚ŠãŸã„ãªï½ï½ï½ã€‚</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>åŒæœŸé–¢æ•°ã¯éåŒæœŸã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã€ã¿ãŸã„ãªé–¢ä¿‚ãŒã‚ã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆ</p>
<p class="p4">// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ JSON ã‚’å–å¾—ã—ã€</p>
<p class="p4">// User ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹</p>
<p class="p4">// éåŒæœŸé–¢æ•° fetchUser ã‚’å®Œæˆã•ã›ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p4">//</p>
<p class="p4">// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ JSON ã‚’å–å¾—ã™ã‚‹ã«ã¯</p>
<p class="p4">// download é–¢æ•°ã‚’ç”¨ã„ã¾ã™ã€‚</p>
<p class="p4">// download ã®å®Ÿè£…ã¯æ“¬ä¼¼çš„ãªã‚‚ã®ã§ã™ãŒ</p>
<p class="p4">// å¤‰æ›´ã›ãšã«ãã®ã¾ã¾åˆ©ç”¨ã—ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p4">//</p>
<p class="p4">// ãªãŠã€é€šä¿¡ã‚„ãƒ‡ã‚³ãƒ¼ãƒ‰ã«èµ·å› ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã¯</p>
<p class="p4">// èµ·ã“ã‚‰ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">struct User: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var name: String</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var thumbnailURL: URL</p>
<p class="p4">}</p>
<p class="p4">func download(from url: URL, completion: @escaping (Data) -&gt; Void) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try! Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>completion(data)</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">func fetchUser(for id: User.ID, completion: @escaping (User) -&gt; Void) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=\(id.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>// <span class="s1">ğŸš§</span> ã“ã“ã‚’å®Ÿè£…ã™ã‚‹</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>download(from: url) { data in</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let user = try! JSONDecoder().decode(User.self, from:data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completion(user)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">fetchUser(for: 123) { user in</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>print(user.name)</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">asyncã«ã‚ˆã‚‹éåŒæœŸç‰ˆ</p>
<p class="p4">// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ JSON ã‚’å–å¾—ã—ã€</p>
<p class="p4">// User ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹</p>
<p class="p4">// éåŒæœŸé–¢æ•° fetchUser ã‚’å®Œæˆã•ã›ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p4">//</p>
<p class="p4">// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ JSON ã‚’å–å¾—ã™ã‚‹ã«ã¯</p>
<p class="p4">// download é–¢æ•°ã‚’ç”¨ã„ã¾ã™ã€‚</p>
<p class="p4">// download ã®å®Ÿè£…ã¯æ“¬ä¼¼çš„ãªã‚‚ã®ã§ã™ãŒ</p>
<p class="p4">// å¤‰æ›´ã›ãšã«ãã®ã¾ã¾åˆ©ç”¨ã—ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p4">//</p>
<p class="p4">// ãªãŠã€é€šä¿¡ã‚„ãƒ‡ã‚³ãƒ¼ãƒ‰ã«èµ·å› ã™ã‚‹ã‚¨ãƒ©ãƒ¼ã¯</p>
<p class="p4">// èµ·ã“ã‚‰ãªã„ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">struct User: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var name: String</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var thumbnailURL: URL</p>
<p class="p4">}</p>
<p class="p4">func download(from url: URL) async -&gt; Data {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try! Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return data</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">func fetchUser(for id: User.ID) async -&gt; User {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=\(id.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>// <span class="s1">ğŸš§</span> ã“ã“ã‚’å®Ÿè£…ã™ã‚‹</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data = await download(from: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let user = try! JSONDecoder().decode(User.self, from:data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return user</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">// func foo() {</p>
<p class="p4">// <span class="Apple-converted-space">Â  Â  </span>var a:() async -&gt; Int = {42}</p>
<p class="p4">// <span class="Apple-converted-space">Â  Â  </span>// var b:() -&gt; Int = {42}</p>
<p class="p4">// <span class="Apple-converted-space">Â  Â  </span>// a = b// ã“ã‚Œã¯ãªã‚“ã‹syncãŒasyncã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹ã“ã¨ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒé€šã‚‹ã‹ã‚‰è¨¼æ˜ã§ãã¦ã‚‹ã­ã¿ãŸã„ãªä¾‹ã€‚é€† b = aã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã€‚</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4">// <span class="Apple-converted-space">Â  Â  </span>var c = await a()</p>
<p class="p4">// <span class="Apple-converted-space">Â  Â  </span>print(c)</p>
<p class="p4">// }</p>
<p class="p5"><br></p>
<p class="p4">runAsyncAndBlock {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>// foo()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let user = await fetchUser(for: 123)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>print(user.name)</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">ã‚¨ãƒ©ãƒ¼ãŒèµ·ã“ã‚Šå¾—ã‚‹å ´åˆ</p>
<p class="p4">func download(from url: URL) <b>async throws</b> -&gt; Data<span class="Apple-converted-space">Â </span></p>
<p class="p5"><br></p>
<p class="p4">do {</p>
<p class="p4"><span class="Apple-tab-span">	</span>let data = <b>try await </b>download(from: url)</p>
<p class="p4"><span class="Apple-tab-span">	</span>// ã“ã“ã§dataã‚’ä½¿ã†</p>
<p class="p4">} catch {</p>
<p class="p4"><span class="Apple-tab-span">	</span>// ã“ã“ã§ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’è¡Œã†</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p3">å…ˆã«awaitãŒè¡Œã‚ã‚Œã¦tryãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã¯async throws ã¨ã„ã†é †ç•ªã«ãªã‚‹ã€‚ã“ã‚Œã¯å›ºå®šã€‚</p>
<p class="p2"><br></p>
<p class="p3">ã‚ã¡ã‚ƒãã¡ã‚ƒåˆç†çš„ã€‚</p>
<p class="p2"><br></p>
<p class="p3">catchã‚’åˆæˆã§ãã‚‹ -&gt; è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ã‚’åŒã˜catchã§æ‰±ãˆã‚‹ / æ‰±ã‚ãªã„ã¨ã„ã‘ãªããªã‚‹ã®ã§ã€ã†ãƒ¼ã‚“ä¸€é•·ä¸€çŸ­</p>
<p class="p2"><br></p>
<p class="p3">ãƒã‚¹ãƒˆãŒè§£æ¶ˆã§ãã‚‹ + ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒåæŸã•ã‚Œã‚‹</p>
<p class="p3"><span class="Apple-tab-span">	</span>pros-consã‚ã‚‹ã‘ã©æ¯”è¼ƒã—ã¥ã‚‰ã„ãªãƒ¼ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">ä¸¦è¡Œå‡¦ç†ã‚’ã©ã†ã™ã‚Œã°ã„ã„ã‹</p>
<p class="p3"><span class="Apple-tab-span">	</span>è¤‡æ•°ã®go é–¢æ•°ã¿ãŸã„ãªã‚„ã¤</p>
<p class="p2"><br></p>
<p class="p3">é–¢æ•°aã¨bã‚’ä¸¦è¡Œã«å®Ÿè¡Œã—ãŸã„ = åŒæ™‚ã«å¾…ã¡ãŸã„ã€ã¿ãŸã„ãªã‚±ãƒ¼ã‚¹ã‚’ã©ã†ã™ã‚‹ã‹</p>
<p class="p2"><br></p>
<p class="p3">async let a = foo()// awaitã‚’ã¤ã‘ã‚‹å¿…è¦ãŒãªã„</p>
<p class="p3">async let b = bar()// awaitã‚’ã¤ã‘ã‚‹å¿…è¦ãŒãªã„</p>
<p class="p2"><br></p>
<p class="p3">print(await a + b)// ã¾ã¨ã‚ã¦awaitã™ã‚‹</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>JSã®å ´åˆã¯ã€asyncãªé–¢æ•°ã¯å¿…ãšpromiseã‚’è¿”ã—ã¦ãã‚‹ã®ã§ã€å€‹ã€…ã«awaitã§å‰¥ãŒã™å½¢ã«ãªã‚‹ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>print(await a + await b)ã¨ã‹ã«ãªã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">JSã®å ´åˆã¯promiseå‹ã‚’è¿”ã™ã®ã§ã€promiseå‹ã‚’éœ²å‡ºã•ã›ã‚‹ã“ã¨ãŒã§ãã¦ã—ã¾ã†ãŒã€</p>
<p class="p3">swiftã®å ´åˆã¯ãã†ã„ã†ã“ã¨ãŒèµ·ããªã„ãŸã‚ã€promiseæ±šæŸ“ãŒèµ·ã“ã›ãªã„ã€‚ã„ã„è©±ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">structured concurrency ã¨ã„ã†ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«åŸºã¥ã„ã¦ä½œã‚‰ã‚Œã¦ã¦ã€Kotlinã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã€‚</p>
<p class="p3">swiftã‚‚ã“ã‚Œã‚’æ¡ç”¨ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>-&gt; ã“ã‚Œã‚’è¿½ã†ã¨é¢ç™½ãã†ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">task.withgroupã¿ãŸã„ãªã®ã‚‚ã‚ã‚‹ã‚‰ã—ã„ã€‚async letã§æ›¸ã‘ã‚‹ç¯„å›²ãªã‚‰ãã‚Œã§æ›¸ãã¨ã™ã”ãæ¥½</p>
<p class="p3">ãŸã ã—å®£è¨€çš„ãªã®ã§ã€å¯å¤‰æ€§ã‚’æŒãŸã›ã‚‹ã‚ˆã†ãªæ›¸ãæ–¹ã¯ã§ããªã„ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">åŒæ™‚ã«èµ°ã‚‰ã›ã‚‹ver</p>
<p class="p4">// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ User ã¨ãã® Article æœ€æ–° 10 ä»¶ã® JSON ã‚’å–å¾—ã—ã€</p>
<p class="p4">// ãã‚Œã‚‰ã‚’è¿”ã™éåŒæœŸé–¢æ•° fetchUserWithArticles ã‚’å®Ÿè£…ã—ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p4">// ãŸã ã—ã€ User ã¨ Article ã® JSON ã¯ä¸¦è¡Œã—ã¦å–å¾—ã™ã‚‹ã‚‚ã®ã¨ã—ã€</p>
<p class="p4">// User ã¨ Artcile ã®å–å¾—ã«ã¯ fetchUser ãŠã‚ˆã³</p>
<p class="p4">// fetchArticles ã‚’ç”¨ã„ã‚‹ã‚‚ã®ã¨ã—ã¾ã™ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">struct User: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var name: String</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var thumbnailURL: URL</p>
<p class="p4">}</p>
<p class="p4">struct Article: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var title: String</p>
<p class="p4">}</p>
<p class="p4">func fetchUser(for id: User.ID) async throws -&gt; User {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=\(id.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let user: User = try JSONDecoder().decode(User.self, from: data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return user</p>
<p class="p4">}</p>
<p class="p4">func fetchArticles(for userID: User.ID, limit: Int) async throws -&gt; [Article] {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/articles?userID=\(userID.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let articles: [Article] = try JSONDecoder().decode([Article].self, from: data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return articles</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">func fetchUserWithArticles(for id: User.ID, limit: Int) async throws -&gt; (user: User, articles: [Article]) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>// <span class="s1">ğŸš§</span> ã“ã“ã‚’å®Ÿè£…ã™ã‚‹</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>async let user =<span class="Apple-converted-space">Â  </span>fetchUser(for:id)// ã“ã“ã«awaitã‚’ã¤ã‘ã‚‹ã¨ä»£å…¥å‰ã«fetchUserãŒçµ‚ã‚ã‚‹ã€ãªã‚‹ã»ã©</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>async let articles =<span class="Apple-converted-space">Â  </span>fetchArticles(for: id, limit:limit)</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let result = try await(user, articles)// ã“ã“ã§ã¾ã¨ã‚ã¦awaitã§å‰¥ãŒã—ã¦ã€</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return result</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">// ãã®ã¾ã¾ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«ã¯æ›¸ã‘ãªã„ã€‚runAsyncAndBlockã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚</p>
<p class="p4">runAsyncAndBlock {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>do {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let (user, articles) = try await fetchUserWithArticles(for: 123, limit: 10)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>print(user, articles)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>} catch {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>print(error)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p4">@asyncHandler</p>
<p class="p4">func bar() {</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(2)</p>
<p class="p4"><span class="Apple-tab-span">	</span>await foo1()</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(4)</p>
<p class="p4"><span class="Apple-tab-span">	</span>await foo2()</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(5)</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">print(1)</p>
<p class="p4">bar()</p>
<p class="p4">print(3)</p>
<p class="p2"><br></p>
<p class="p3">ã“ã‚Œã¯1,2,3,4,5ã‚’å‡ºåŠ›ã™ã‚‹</p>
<p class="p2"><br></p>
<p class="p3">asyncã‚’ã¤ã‘ã‚‹ã¨ã“ã†ãªã‚‹</p>
<p class="p4">func bar() async {</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(2)</p>
<p class="p4"><span class="Apple-tab-span">	</span>await foo1()</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(3)</p>
<p class="p4"><span class="Apple-tab-span">	</span>await foo2()</p>
<p class="p4"><span class="Apple-tab-span">	</span>print(4)</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">print(1)</p>
<p class="p4">await bar()</p>
<p class="p4">print(5)</p>
<p class="p2"><br></p>
<p class="p3">1,2,3,4,5ã‚’å‡ºåŠ›ã™ã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">asyncã®æ ¹ã£ã“ã«ãªã‚Œã‚‹ã‚‚ã®ãŒ4ã¤ã‚ã‚‹</p>
<p class="p3"><span class="Apple-tab-span">	</span>ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«</p>
<p class="p3"><span class="Apple-tab-span">	</span>@main</p>
<p class="p3"><span class="Apple-tab-span">	</span>@asyncHandler</p>
<p class="p3"><span class="Apple-tab-span">	</span>Task.runDetached</p>
<p class="p3"><span class="Apple-tab-span">	</span>(runAsyncAndBlock)// ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã®æš«å®šçš„ãªæ‰‹æ®µãŒç”¨æ„ã•ã‚Œã¦ã‚‹ã‚“ã ã£ã¦ã•ã€‚</p>
<p class="p3">ã“ã‚Œã‚‰ã‚’åˆ©ç”¨ã—ã¦ç„¡é™asyncæ±šæŸ“å•é¡Œã«å¯¾å‡¦ãŒã§ãã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p4">// ViewController ã® reloadUserButton ãŒæŠ¼ã•ã‚ŒãŸã¨ãã«</p>
<p class="p4">// fetchUser é–¢æ•°ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ User ã‚’å–å¾—ã—ã€</p>
<p class="p4">// userNameLabel.text ã«å–å¾—ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã® name ã‚’è¨­å®šã™ã‚‹ã‚ˆã†ã«</p>
<p class="p4">// onReloadUserButtonPressed ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Œæˆã•ã›ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">class UIViewController {}</p>
<p class="p4">final class UIButton {}</p>
<p class="p4">final class UILabel {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var text: String?</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">struct User: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var name: String</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var thumbnailURL: URL</p>
<p class="p4">}</p>
<p class="p4">func fetchUser(for id: User.ID) async throws -&gt; User {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=\(id.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let user: User = try JSONDecoder().decode(User.self, from: data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return user</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">final class ViewController: UIViewController {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let reloadUserButton: UIButton = .init()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let userNameLabel: UILabel = .init()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let userID: User.ID = 123</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>// <span class="s1">ğŸš§</span> ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Œæˆã•ã›ã‚‹</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>@asyncHandler</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>func onReloadUserButtonPressed(_ sender: UIButton) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if let user = try? await fetchUser(for: userID) {// ã“ã®é–¢æ•°ã«asyncãŒã¤ã„ã¦ãªã„ã‘ã©@asyncHandlerãŒã‚ã‚‹ã®ã§awaitãŒæ›¸ã‘ã‚‹</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>userNameLabel.text = user.name</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">let viewController: ViewController = .init()</p>
<p class="p4">viewController.onReloadUserButtonPressed(viewController.reloadUserButton)</p>
<p class="p2"><br></p>
<p class="p3">åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œã®èµ·ç‚¹ã«ãªã‚‹ã ã‘ãªã®ã§ã€ã‚¹ãƒˆãƒƒãƒ—ã›ãšã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">Taskã¯asyncé–¢æ•°ã«ã¨ã£ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã®ã‚ˆã†ãªç‰©ã§ã€</p>
<p class="p3">asyncé–¢æ•°ã®ä¸­ã§awaitã‹ã‚‰å¸°ã£ã¦ããŸã‚‰åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ãªã‚‹ãŒã€Taskã¨ã„ã†æ¦‚å¿µã¯ç¶™ç¶šã—ã¦åŒã˜ã‚‚ã®ãŒä½¿ã‚ã‚Œã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p3">async1ã¤ã«å¯¾ã—ã¦Task1ã¤ãŒç¶™ç¶šæ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚</p>
<p class="p2"><br></p>
<p class="p3">ã§ã€async letã™ã‚‹ã¨ã€ãã®å®Ÿè¡Œã¯child taskãŒç”Ÿæˆã•ã‚Œã¦å®Ÿè¡Œã•ã‚Œã‚‹ã€‚</p>
<p class="p3">ã§ã€runDetachedé–¢æ•°ã¯.cancel()é–¢æ•°ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€ä¸Šä½ã‹ã‚‰ä¸¸ã”ã¨ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒã§ãã‚‹ã€‚</p>
<p class="p2"><br></p>
<p class="p3">ã†ãƒ¼ã‚“ã“ã‚Œã¯ä¾¿åˆ©ã€‚goã®contextã ã€‚kotlinã§ã‚‚ã§ãã‚‹ã‚“ã ã‚ã†ã‹?ã¨ã®ã“ã¨</p>
<p class="p2"><br></p>
<p class="p4">// ViewController ã® cancelReloadingUser ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨</p>
<p class="p4">// reloadUser ãƒœã‚¿ãƒ³ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ User ã®ãƒªãƒ­ãƒ¼ãƒ‰ã‚’</p>
<p class="p4">// ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã‚ˆã†ã« ViewController ã®å®Ÿè£…ã‚’å®Œæˆã•ã›ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">class UIViewController {}</p>
<p class="p4">final class UIButton {}</p>
<p class="p4">final class UILabel {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var text: String?</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">struct User: Identifiable, Codable {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>typealias ID = Int</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let id: ID</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var name: String</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var thumbnailURL: URL</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">func fetchUser(for id: User.ID) async throws -&gt; User {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=\(id.description)")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let data: Data = try Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let user: User = try JSONDecoder().decode(User.self, from: data)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>return user</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">// <span class="s1">ğŸš§</span> ã“ã®ã‚¯ãƒ©ã‚¹ã‚’å®Œæˆã•ã›ã‚‹</p>
<p class="p4">final class ViewController: UIViewController {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let reloadUserButton: UIButton = .init()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let cancelReloadingUserButton: UIButton = .init()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>let userNameLabel: UILabel = .init()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>var handle:Task.Handle&lt;Void&gt;?</p>
<p class="p5"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>func onReloadUserButtonPressed(_ sender: UIButton) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>handle = Task.runDetached { [self] in</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if let user = try? await fetchUser(for: 123) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>userNameLabel.text = user.name</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p5"><br></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>func onCancelReloadingUserButtonPressed(_ sender: UIButton) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>handle?.cancel()</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">let viewController: ViewController = .init()</p>
<p class="p4">viewController.onReloadUserButtonPressed(viewController.reloadUserButton)</p>
<p class="p4">viewController.onCancelReloadingUserButtonPressed(viewController.cancelReloadingUserButton)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">ãƒ¡ãƒ¢</p>
<p class="p3"><span class="Apple-tab-span">	</span>callback -&gt; é–¢æ•°ã‚’å‘¼ã³å‡ºã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§</p>
<p class="p3"><span class="Apple-tab-span">	</span>dispatchqueue.async() ã§ã©ã“ã‹ã«æŠ•ã’è¾¼ã‚€</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>ãƒ»taskãŒexecutorã¿ãŸã„ãªã®ã‚’æŒã¦ã‚‹ã‚ˆã†ã«ãªã£ã¦ã‚‹</p>
<p class="p3"><span class="Apple-tab-span">	</span>ãƒ»awaitã‹ã‚‰æˆ»ã£ã¦ããŸæ™‚ã«continuationã™ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ã©ã†ã™ã‚‹ã‹ã¿ãŸã„ãªã®ã¯executorã®è²¬å‹™ã«ãªã£ã¦ã„ã‚‹ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>ãƒ»ã©ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«æˆ»ã‚‹ã‹ã‚’è¨­å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹</p>
<p class="p2"><span class="Apple-converted-space">Â </span></p>
<p class="p3"><span class="Apple-tab-span">	</span>actorã¾ã‚ã‚Šã¨é–¢é€£ã—ã¦ã‚‹ã‚‰ã—ã„ã€ã€ã‚ã‹ã‚“ã­ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>actorã¯è‡ªèº«ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå¿…ãšãã“ã§ç›´åˆ—åŒ–ã•ã‚Œã‚‹ï¼Ÿ</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">é–¢æ•°ã‚’asyncåŒ–ã—ã¦ã¿ã‚ˆã†</p>
<p class="p3">func foo(completion: @escaping) ~ ã¿ãŸã„ãªã®ãŒã‚ã£ãŸæ™‚ã«ã€</p>
<p class="p2"><br></p>
<p class="p3">withUnsafeContinuation { continuation in ã‚’ä½¿ã£ã¦</p>
<p class="p3"><span class="Apple-tab-span">	</span>foo {</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>continuation.resume(returning: value)</p>
<p class="p3"><span class="Apple-tab-span">	</span>}</p>
<p class="p3">}</p>
<p class="p2"><br></p>
<p class="p3">unsafeã¨checkedãŒã‚ã‚‹ã€‚checkedã‚’ã¤ã‘ã‚‹ã¨continuation.resumeã®å‘¼ã³å¿˜ã‚Œã‚’ã‚¨ãƒ©ãƒ¼ã«ã§ãã‚‹ã€‚</p>
<p class="p3">å½“ç„¶checkedã®ã»ã†ãŒã„ã‚ã‚“ãªã‚³ã‚¹ãƒˆãŒã‚ã‚‹ã¨ã®ã“ã¨ã€‚</p>
<p class="p2"><br></p>
<p class="p3">ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’asyncã§ãƒ©ãƒƒãƒ—ã—ã¦asyncåŒ–ã—ã‚ˆã†</p>
<p class="p4">// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§çµæœã‚’å—ã‘å–ã‚‹éåŒæœŸé–¢æ•° download ã‚’ä½¿ã£ã¦ã€</p>
<p class="p4">// async ã§çµæœã‚’è¿”ã™éåŒæœŸé–¢æ•° download ã‚’å®Ÿè£…ã—ã¦ä¸‹ã•ã„ã€‚</p>
<p class="p5"><br></p>
<p class="p4">import Foundation</p>
<p class="p4">import FoundationNetworking</p>
<p class="p5"><br></p>
<p class="p4">func download(from url: URL, completion: @escaping (Result&lt;Data, Error&gt;) -&gt; Void) {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>do {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let data: Data = try Data(contentsOf: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completion(.success(data))</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>} catch {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completion(.failure(error))</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">// <span class="s1">ğŸš§</span> ã“ã“ã‚’å®Ÿè£…ã™ã‚‹</p>
<p class="p4">func download(from url: URL) async throws -&gt; Data {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>try await withUnsafeThrowingContinuation { continuation in</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>download(from: url) { result in<span class="Apple-converted-space">Â </span></p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>continuation.resume(with: result)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p5"><br></p>
<p class="p4">runAsyncAndBlock {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>do {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let url: URL = URL(string: "https://koherent.org/async-await-challenge/api/user?id=123")!</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let data: Data = try await download(from: url)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>print(String(data: data, encoding: .utf8)!)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>} catch {</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  Â  Â  </span>print(error)</p>
<p class="p4"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p4">}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">æˆ»ã‚Šã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã‹ã¯ã©ã†ãªã£ã¡ã‚ƒã†ã‚“ã ã‚ã†</p>
<p class="p3"><span class="Apple-tab-span">	</span>UIã‚¹ãƒ¬ãƒƒãƒ‰ã«æŒ‡å®šã—ãŸã„ã€ã¨ã‹ã¯ã‚ã‚Šãã†ã ã‘ã©ã€ãã‚Œã¯ã©ã†ã‚„ã‚‹ã‚“ã ã‚ã†ã€‚</p>
<p class="p3"><span class="Apple-tab-span">	</span>-&gt; GDCã§ã¯ã„ã€‚ã¾ã‚ã‚ã‚Œã‚¹ãƒƒã‚²ãƒ¼ä¾¿åˆ©ã ã‚‚ã‚“ãª</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p2"><br></p>
</body>
</html>
