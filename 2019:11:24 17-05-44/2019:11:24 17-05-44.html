<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head><link rel="stylesheet" type="text/less" href="../stylesheets/less/default.less"/><script type="text/javascript" src="../javascripts/less-1.3.0.min.js"></script>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1671.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px 'Hiragino Sans'}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; color: #000000; background-color: #e6e6e6}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; background-color: #e6e6e6}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #4689cc; background-color: #000000}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; background-color: #000000}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; background-color: #000000; min-height: 14.0px}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px 'Helvetica Neue'; color: #000000; color: rgba(0, 0, 0, 0.85)}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Menlo; color: #262626}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; background-color: #000000}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; line-height: 18.0px; font: 12.0px Menlo; color: #cacaca; -webkit-text-stroke: #cacaca; min-height: 14.0px}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; -webkit-text-stroke: #cacaca}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Hiragino Sans'; -webkit-text-stroke: #cacaca; min-height: 18.0px}
    span.s1 {font-variant-ligatures: no-common-ligatures}
    span.s2 {font: 12.0px Helvetica}
    span.s3 {font-kerning: none}
    span.s4 {font-kerning: none; color: #cacaca}
    span.s5 {font-kerning: none; color: #4689cc}
    span.s6 {font-kerning: none; color: #c9caca}
    span.s7 {font-kerning: none; color: #a7c598}
    span.s8 {font-kerning: none; color: #d4d69a}
    span.s9 {font: 12.0px Menlo; font-kerning: none; color: #c27e65; background-color: #171717}
    span.s10 {font: 12.0px 'Hiragino Sans'; color: #000000}
    span.s11 {font-kerning: none; background-color: #eaeaea}
    span.s12 {font: 16.0px 'Hiragino Sans'; font-kerning: none; background-color: #eaeaea}
    span.s13 {font-kerning: none; color: #8cd3fe; -webkit-text-stroke: 0px #8cd3fe}
    span.s14 {font-kerning: none; color: #d4d69a; -webkit-text-stroke: 0px #d4d69a}
    span.s15 {font-kerning: none; color: #c27e65; -webkit-text-stroke: 0px #c27e65}
    span.Apple-tab-span {white-space:pre}
  </style>
</head>
<body>
<p class="p1"><b>GoでWebサイト作る</b></p>
<p class="p2"><br></p>
<p class="p3"><b>概要</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>このへんを見て学ぶ</p>
<p class="p3"><span class="Apple-tab-span">	</span>https://blog.a-know.me/entry/2017/12/26/234528</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>最終的にはDockerとかでやろう。</p>
<p class="p2"><br></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p2"><br></p>
<p class="p3"><b>GOROOTってなーに</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>Goのインストールパス。</p>
<p class="p2"><br></p>
<p class="p3"><b>GOPATHってなーに</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>プロジェクト置き場。</p>
<p class="p3"><span class="Apple-tab-span">	</span>ここの下に置かないといけないのなんでなんだろ、ちょっとわからんので調べよう。</p>
<p class="p3"><span class="Apple-tab-span">	</span>-&gt; workspaceだからとのこと。なるほど。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>go install コマンドは何をしてるの？</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>binフォルダ以下にバイナリができる。</p>
<p class="p3"><span class="Apple-tab-span">	</span>パッケージのコンパイルと依存性解決、というのがinstallコマンドの役割ぽい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>go build</b></p>
<p class="p3"><span class="Apple-tab-span">	</span>goのコードをその場でビルドできる。依存性解決とかやるにはgo getとかやる必要がある。</p>
<p class="p3"><span class="Apple-tab-span">	</span>installはそのへんを自動化してくれるのかな。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>http://imagawa.hatenadiary.jp/entry/2016/12/24/190000</p>
<p class="p3"><span class="Apple-tab-span">	</span>-&gt; 正解っぽい。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><b>ChitChat編</b></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>コードがすでに完成されているものを見るしかないのがわかった。どうやって切り捨てていこうかなー。</p>
<p class="p3"><span class="Apple-tab-span">	</span>git化した。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">続きをやっていく、そろそろDBに入る!</p>
<p class="p3"><span class="Apple-tab-span">	</span>ここでいうThreadとは多言語のスレッドのことではなくチャットのスレッドのこと。</p>
<p class="p3"><span class="Apple-tab-span">	</span>Postgressapp入れてpostgress動かす。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>Postgressapp.comからDL、</p>
<p class="p2"><br></p>
<p class="p4"><span class="s1">export PATH=$PATH:/Applications/Postgres.app/Contents/Versions/latest/bin</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で接続できるように。</p>
<p class="p5">psql --version</p>
<p class="p4"><span class="s1">psql (PostgreSQL) 12.1</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>Postgress.app上でInitializeってやると初期化開始できた。</p>
<p class="p2"><br></p>
<p class="p5">createdb chitchat<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-tab-span">	</span>をコマンドラインで実行した結果、</p>
<p class="p6"><img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202019-11-29%2010.05.00.png" alt="スクリーンショット 2019-11-29 10.05.00.png"></p>
<p class="p3"><span class="s2"><span class="Apple-tab-span">	</span></span>こんな感じになった。</p>
<p class="p3"><span class="Apple-tab-span">	</span>で、次のsetup.sqlファイルをpsqlコマンドで実行すると、-dで設定したデータベースに対してsql文が発行される。</p>
<p class="p2"><br></p>
<p class="p4"><span class="s1">psql -f data/setup.sql -d chitchat</span></p>
<p class="p2"><br></p>
<p class="p7"><span class="s3">drop</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> posts;</span></p>
<p class="p8"><span class="s5">drop</span><span class="s3"> </span><span class="s5">table</span><span class="s3"> threads;</span></p>
<p class="p7"><span class="s3">drop</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> </span><span class="s6">sessions</span><span class="s4">;</span></p>
<p class="p7"><span class="s3">drop</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> users;</span></p>
<p class="p9"><span class="s3"></span><br></p>
<p class="p9"><span class="s3"></span><br></p>
<p class="p7"><span class="s3">create</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> users</span></p>
<p class="p8"><span class="s3">(</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>id </span><span class="s3">serial</span><span class="s4"> </span><span class="s3">primary</span><span class="s4"> </span><span class="s3">key</span><span class="s4">,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>uuid </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">64</span><span class="s3">) </span><span class="s5">not</span><span class="s3"> </span><span class="s5">null</span><span class="s3"> unique,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">name</span><span class="s4"> </span><span class="s3">varchar</span><span class="s4">(</span><span class="s7">255</span><span class="s4">),</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>email </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">255</span><span class="s3">) </span><span class="s5">not</span><span class="s3"> </span><span class="s5">null</span><span class="s3"> unique,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s3">password</span><span class="s4"> </span><span class="s3">varchar</span><span class="s4">(</span><span class="s7">255</span><span class="s4">) </span><span class="s3">not</span><span class="s4"> </span><span class="s3">null</span><span class="s4">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>created_at </span><span class="s3">timestamp</span><span class="s4"> </span><span class="s3">not</span><span class="s4"> </span><span class="s3">null</span></p>
<p class="p8"><span class="s3">);</span></p>
<p class="p9"><span class="s3"></span><br></p>
<p class="p7"><span class="s3">create</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> sessions</span></p>
<p class="p8"><span class="s3">(</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>id </span><span class="s3">serial</span><span class="s4"> </span><span class="s3">primary</span><span class="s4"> </span><span class="s3">key</span><span class="s4">,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>uuid </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">64</span><span class="s3">) </span><span class="s5">not</span><span class="s3"> </span><span class="s5">null</span><span class="s3"> unique,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>email </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">255</span><span class="s3">),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s8">user_id</span><span class="s4"> </span><span class="s3">integer</span><span class="s4"> </span><span class="s3">references</span><span class="s4"> users(id),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>created_at </span><span class="s3">timestamp</span><span class="s4"> </span><span class="s3">not</span><span class="s4"> </span><span class="s3">null</span></p>
<p class="p8"><span class="s3">);</span></p>
<p class="p9"><span class="s3"></span><br></p>
<p class="p7"><span class="s3">create</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> threads</span></p>
<p class="p8"><span class="s3">(</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>id </span><span class="s3">serial</span><span class="s4"> </span><span class="s3">primary</span><span class="s4"> </span><span class="s3">key</span><span class="s4">,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>uuid </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">64</span><span class="s3">) </span><span class="s5">not</span><span class="s3"> </span><span class="s5">null</span><span class="s3"> unique,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>topic </span><span class="s5">text</span><span class="s3">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s8">user_id</span><span class="s4"> </span><span class="s3">integer</span><span class="s4"> </span><span class="s3">references</span><span class="s4"> users(id),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>created_at </span><span class="s3">timestamp</span><span class="s4"> </span><span class="s3">not</span><span class="s4"> </span><span class="s3">null</span></p>
<p class="p8"><span class="s3">);</span></p>
<p class="p9"><span class="s3"></span><br></p>
<p class="p7"><span class="s3">create</span><span class="s4"> </span><span class="s3">table</span><span class="s4"> posts</span></p>
<p class="p8"><span class="s3">(</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>id </span><span class="s3">serial</span><span class="s4"> </span><span class="s3">primary</span><span class="s4"> </span><span class="s3">key</span><span class="s4">,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>uuid </span><span class="s5">varchar</span><span class="s3">(</span><span class="s7">64</span><span class="s3">) </span><span class="s5">not</span><span class="s3"> </span><span class="s5">null</span><span class="s3"> unique,</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>body </span><span class="s5">text</span><span class="s3">,</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span></span><span class="s8">user_id</span><span class="s4"> </span><span class="s3">integer</span><span class="s4"> </span><span class="s3">references</span><span class="s4"> users(id),</span></p>
<p class="p8"><span class="s3"><span class="Apple-converted-space">  </span>thread_id </span><span class="s5">integer</span><span class="s3"> </span><span class="s5">references</span><span class="s3"> threads(id),</span></p>
<p class="p7"><span class="s4"><span class="Apple-converted-space">  </span>created_at </span><span class="s3">timestamp</span><span class="s4"> </span><span class="s3">not</span><span class="s4"> </span><span class="s3">null</span></p>
<p class="p8"><span class="s3">);</span></p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p3"><span class="Apple-tab-span">	</span>users, sessions, threads, postsなどのテーブルが作成される。</p>
<p class="p3"><span class="Apple-tab-span">	</span>それぞれidがあって、みたいな構造になってる。</p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で、これにアクセスするDbインスタンスを作る。</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p4"><span class="s1">db connect errsql: unknown driver "postgres" (forgotten import?)</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>コードを実行するとこんな感じのエラーが出た。</p>
<p class="p3"><span class="Apple-tab-span">	</span>で、すでにimportされてる<span class="s9">database/sql</span>はこれ汎用SQLのドライバーで、その下層に位置するべきpostgresのドライバがimportされてなかった。</p>
<p class="p4"><span class="s1">go get github.com/lib/pq</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>で解決した。importだと解決できなかった(解決されなかった)のなんでだろう。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3">DBについて</p>
<p class="p3"><span class="Apple-tab-span">	</span>https://qiita.com/H-A-L/items/fe8cb0e0ee0041ff3ceb</p>
<p class="p3"><span class="Apple-tab-span">	</span>ここをみてポスグレについて学んでいる。</p>
<p class="p2"><br></p>
<p class="p10"><span class="s10"><span class="Apple-tab-span">	</span></span>/Applications/Postgres.app/Contents/Versions/12/bin/psql -p5432 “chitchat”</p>
<p class="p3"><span class="Apple-tab-span">	</span>みたいなコマンドでchitchat DBにログイン、</p>
<p class="p2"><br></p>
<p class="p11"><span class="s10"><span class="Apple-tab-span">	</span></span><span class="s11">select * from </span><span class="s12">users</span><span class="s11">;</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>とかでユーザー一覧を取得。</p>
<p class="p2"><br></p>
<p class="p4"><span class="s1">chitchat=# select * from users;</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space"> </span>id | <span class="Apple-converted-space">                </span>uuid <span class="Apple-converted-space">                </span>| name | email | <span class="Apple-converted-space">                </span>password <span class="Apple-converted-space">                </span>| <span class="Apple-converted-space">        </span>created_at<span class="Apple-converted-space">         </span></span></p>
<p class="p4"><span class="s1">----+--------------------------------------+------+-------+------------------------------------------+----------------------------</span></p>
<p class="p4"><span class="s1"><span class="Apple-converted-space">  </span>1 | 31467eda-ae54-47e6-5a41-25cbee98e6ad | a<span class="Apple-converted-space">    </span>| a@a.a | df51e37c269aa94d38f93e537bf6e2020b21406c | 2019-12-04 15:44:49.768178</span></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>こんな風に取得できる。あとは条件をいろいろorder byとかで決めれば良さそう。語句はぜんぜん覚えられないな、、へんな法則してそう。</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p3"><span class="Apple-tab-span">	</span>Queryについて、</p>
<p class="p12"><span class="s13">err</span><span class="s3"> = Db.</span><span class="s14">QueryRow</span><span class="s3">(</span><span class="s15">"select id, uuid, email, user_id, created_at from sessions where uuid = $1"</span><span class="s3">, session.UUID).</span><span class="s14">Scan</span><span class="s3">(&amp;session.ID, &amp;session.UUID, &amp;session.Email, &amp;session.UserID, &amp;session.CreatedAt)</span></p>
<p class="p13"><span class="s3"></span><br></p>
<p class="p14"><span class="Apple-tab-span">	</span>こんな感じに書くと、from句の前に書いた情報のうち、where句に該当する = uuidが指定したものと一致するデータが取得でき、Scanメソッドで代入させられる。</p>
<p class="p15"><br></p>
<p class="p14">さて、privateには入れた = ログインの概念が理解できたんで、次いってみよう。スレッドどうやって作るの？ UI足りてなくない？</p>
<p class="p14"><span class="Apple-tab-span">	</span>-&gt; テンプレートエンジンにcontentを足すと表示できた。生成もOK。</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p14"><span class="Apple-tab-span">	</span>で、ここからどうするか。とりあえず全体を流し読みしよう。</p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
<p class="p15"><br></p>
</body>
</html>
